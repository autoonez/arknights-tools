import{u as ie}from"./VBtn.07902e6c.js";import{q as ee,y as j,B as ue,A as te,r as H,aj as pe,ak as ce,l as x,g as me,ai as U,n as G,a8 as fe,z as ae,al as ge,am as X,an as _,ao as Y,ap as q,aq as W,ar as se,ah as Z}from"./index.df28dd6e.js";const M=Symbol.for("vuetify:layout"),re=Symbol.for("vuetify:layout-item"),J=1e3,xe=ee({overlaps:{type:Array,default:()=>[]},fullHeight:Boolean},"layout"),Ee=ee({name:{type:String},order:{type:[Number,String],default:0},absolute:Boolean},"layout-item");function be(){const m=j(M);if(!m)throw new Error("[Vuetify] Could not find injected layout");return{getLayoutItem:m.getLayoutItem,mainRect:m.mainRect,mainStyles:m.mainStyles}}function Te(m){var u;const t=j(M);if(!t)throw new Error("[Vuetify] Could not find injected layout");const i=(u=m.id)!=null?u:`layout-item-${ue()}`,e=te("useLayoutItem");ae(re,{id:i});const c=H(!1);pe(()=>c.value=!0),ce(()=>c.value=!1);const{layoutItemStyles:r,layoutItemScrimStyles:p}=t.register(e,{...m,active:x(()=>c.value?!1:m.active.value),id:i});return me(()=>t.unregister(i)),{layoutItemStyles:r,layoutRect:t.layoutRect,layoutItemScrimStyles:p}}const he=(m,t,i,e)=>{let c={top:0,left:0,right:0,bottom:0};const r=[{id:"",layer:{...c}}];for(const p of m){const u=t.get(p),s=i.get(p),a=e.get(p);if(!u||!s||!a)continue;const f={...c,[u.value]:parseInt(c[u.value],10)+(a.value?parseInt(s.value,10):0)};r.push({id:p,layer:f}),c=f}return r};function Oe(m){const t=j(M,null),i=x(()=>t?t.rootZIndex.value-100:J),e=H([]),c=U(new Map),r=U(new Map),p=U(new Map),u=U(new Map),s=U(new Map),{resizeRef:a,contentRect:f}=ie(),C=x(()=>{var g;const d=new Map,y=(g=m.overlaps)!=null?g:[];for(const E of y.filter(h=>h.includes(":"))){const[h,O]=E.split(":");if(!e.value.includes(h)||!e.value.includes(O))continue;const N=c.get(h),R=c.get(O),k=r.get(h),$=r.get(O);!N||!R||!k||!$||(d.set(O,{position:N.value,amount:parseInt(k.value,10)}),d.set(h,{position:R.value,amount:-parseInt($.value,10)}))}return d}),v=x(()=>{const d=[...new Set([...p.values()].map(g=>g.value))].sort((g,E)=>g-E),y=[];for(const g of d){const E=e.value.filter(h=>{var O;return((O=p.get(h))==null?void 0:O.value)===g});y.push(...E)}return he(y,c,r,u)}),o=x(()=>!Array.from(s.values()).some(d=>d.value)),n=x(()=>v.value[v.value.length-1].layer),A=x(()=>({"--v-layout-left":G(n.value.left),"--v-layout-right":G(n.value.right),"--v-layout-top":G(n.value.top),"--v-layout-bottom":G(n.value.bottom),...o.value?void 0:{transition:"none"}})),b=x(()=>v.value.slice(1).map((d,y)=>{let{id:g}=d;const{layer:E}=v.value[y],h=r.get(g),O=c.get(g);return{id:g,...E,size:Number(h.value),position:O.value}})),l=d=>b.value.find(y=>y.id===d),I=te("createLayout"),T=H(!1);fe(()=>{T.value=!0}),ae(M,{register:(d,y)=>{let{id:g,order:E,position:h,layoutSize:O,elementSize:N,active:R,disableTransitions:k,absolute:$}=y;p.set(g,E),c.set(g,h),r.set(g,O),u.set(g,R),k&&s.set(g,k);const K=ge(re,I==null?void 0:I.vnode).indexOf(d);K>-1?e.value.splice(K,0,g):e.value.push(g);const F=x(()=>b.value.findIndex(w=>w.id===g)),P=x(()=>i.value+v.value.length*2-F.value*2),oe=x(()=>{const w=h.value==="left"||h.value==="right",B=h.value==="right",le=h.value==="bottom",V={[h.value]:0,zIndex:P.value,transform:`translate${w?"X":"Y"}(${(R.value?0:-110)*(B||le?-1:1)}%)`,position:$.value||i.value!==J?"absolute":"fixed",...o.value?void 0:{transition:"none"}};if(!T.value)return V;const L=b.value[F.value];if(!L)throw new Error(`[Vuetify] Could not find layout item "${g}"`);const z=C.value.get(g);return z&&(L[z.position]+=z.amount),{...V,height:w?`calc(100% - ${L.top}px - ${L.bottom}px)`:N.value?`${N.value}px`:void 0,left:B?void 0:`${L.left}px`,right:B?`${L.right}px`:void 0,top:h.value!=="bottom"?`${L.top}px`:void 0,bottom:h.value!=="top"?`${L.bottom}px`:void 0,width:w?N.value?`${N.value}px`:void 0:`calc(100% - ${L.left}px - ${L.right}px)`}}),ne=x(()=>({zIndex:P.value-1}));return{layoutItemStyles:oe,layoutItemScrimStyles:ne,zIndex:P}},unregister:d=>{p.delete(d),c.delete(d),r.delete(d),u.delete(d),s.delete(d),e.value=e.value.filter(y=>y!==d)},mainRect:n,mainStyles:A,getLayoutItem:l,items:b,layoutRect:f,rootZIndex:i});const D=x(()=>["v-layout",{"v-layout--full-height":m.fullHeight}]),S=x(()=>({zIndex:i.value,position:t?"relative":void 0,overflow:t?"hidden":void 0}));return{layoutClasses:D,layoutStyles:S,getLayoutItem:l,items:b,layoutRect:f,layoutRef:a}}const de=m=>{var c,r,p;let t={lines:[],tagCount:{},otherLines:[]},i=m.split(`
`),e=u=>{u in t.tagCount||(t.tagCount[u]=0),t.tagCount[u]+=1};for(const u of i)if(u.match(X)){let s=X.exec(u);if(s!=null&&s.groups){let{tag:a,params:f,other:C}=s.groups;a=a.toUpperCase();let v={},o;for(;(o=_.exec(f))!==null;)if(o.groups){const{name:n,value:A}=o.groups;v[n]=A.replace(/"/g,"")}C&&(v.other=C),t.lines.push({tag:a,params:v}),e(a)}}else if(u.match(Y)){let s=Y.exec(u);if(s!=null&&s.groups){let{name:a,params:f,text:C}=s.groups,v={},o;if(f)for(;(o=_.exec((c=s==null?void 0:s.groups)==null?void 0:c.params))!==null;){let n=(r=o.groups)==null?void 0:r.name,A=((p=o.groups)==null?void 0:p.value)||"";n&&(v[n]=A.replace(/"/g,""))}t.lines.push({tag:"DIALOG",params:{...v,name:a,text:C}}),e("DIALOG")}}else if(u.match(q)){let s=q.exec(u);if(s!=null&&s.groups){let{tag:a,value:f}=s.groups;a=a.toUpperCase(),t.lines.push({tag:a,params:{[a]:f}}),e(a)}}else if(u.match(W)){let s=W.exec(u);if(s!=null&&s.groups){let{tag:a}=s.groups;a=a.toUpperCase(),t.lines.push({tag:a,params:{}}),e(a)}}else if(u.length>0&&u.indexOf("//")!==0&&u!=="\r"){let s="DESCRIPTION";t.lines.push({tag:s,params:{text:u}}),e(s)}else t.otherLines.push(u);return t},Q=/\[OPTION (?<value>.*)\]/g,Ae=m=>{var i;let t={lines:[],tagCount:{},otherLines:[]};try{const e=m.find(c=>c[0]==="[LAYOUT]");if(e){const c=e.indexOf("[NAME]"),r=e.indexOf("[TEXT]");if(c&&r){for(let p=0;p<m.length;p++){const u=m[p];let s=u[0]||"";s=s.replace(/[\[\]]/g,"");const a=u[c],f=u[r];if(se.includes(s))t.lines.push({tag:s,params:{name:a,text:f}}),s in t.tagCount?t.tagCount[s]=t.tagCount[s]+1:t.tagCount[s]=1;else if(s==="DECISION"){let C=[],v=[];for(let o=p+1;o<m.length;o++){const n=m[o];if(n[0]==="[END_DECISION]"){t.lines.push({tag:"DECISION",params:{options:C.join(";"),values:v.join(";")}}),"DECISION"in t.tagCount?t.tagCount.DECISION=t.tagCount.DECISION+1:t.tagCount.DECISION=1,p=o;break}if(n[0].match(Q)){const A=Q.exec(n[0]);if(A){const b=(i=A.groups)==null?void 0:i.value;v.push(b),C.push(n[r])}}}}}return{result:t}}else return{error:"[NAME] or [TEXT] not found"}}else return{error:"[LAYOUT] not found"}}catch(e){return{error:e.message}}},Le=({original:m,target:t})=>{let i=[],e={},c={};for(const r of t)r.tag in e||(e[r.tag]=[],c[r.tag]=0),e[r.tag].push(r);for(const r of m)if(r.tag in e)if(c[r.tag]<e[r.tag].length&&Object.keys(r.params).length>0){const p=e[r.tag][c[r.tag]],u=r;r.params.name&&p.params.name&&(u.params.name=p.params.name),r.params.text&&p.params.text&&(u.params.text=p.params.text),r.params.options&&p.params.options&&(u.params.options=p.params.options),i.push(u),c[r.tag]+=1}else i.push(r);else i.push(r);return i},Se=m=>{let t="1",i="1",e="";return m.split("#").length>1?([e,t]=m.split("#"),[t,i]=t.split("$")):m.split("$").length>1?[e,i]=m.split("$"):e=m.split("#")[0],{name:e,num:t,group:i||"1"}},Ne=async m=>{var p,u;let t=[],i=[],e,c,r="";for(let s=0;s<m.length;s++){let a=m[s];switch(a.tag){case"DESCRIPTION":{e?e.tag==="DESCRIPTION"?e.params.text.push(a.params.text):(i.push(e),e={tag:"DESCRIPTION",params:{text:[a.params.text]}}):e={tag:"DESCRIPTION",params:{text:[a.params.text]}};break}case"SUBTITLE":{a.params.text&&(e?e.tag==="SUBTITLE"?e.params.text.push(a.params.text):(i.push(e),e={tag:"SUBTITLE",params:{text:[a.params.text]}}):e={tag:"SUBTITLE",params:{text:[a.params.text]}});break}case"DIALOG":{if(!a.params.text)break;let f={...a.params,text:[a.params.text],image:r};e?e.tag==="DIALOG"&&((u=(p=e.params)==null?void 0:p.name)==null?void 0:u.localeCompare(a.params.name,void 0,{sensitivity:"base"}))===0?e.params.text.push(a.params.text):(i.push(e),e={tag:"DIALOG",params:f}):e={tag:"DIALOG",params:f};break}case"MULTILINE":{let f={tag:"DIALOG",params:{...a.params,text:[a.params.other],image:r}};e&&i.push(e),e=f;break}case"DECISION":{e&&i.push(e);let f=a.params.options.split(";"),C=a.params.values.split(";"),v=!1;if(c){for(let o of C)if(c.options.includes(o)){v=!0;break}}v&&(t.push(i),i=[],e=null),(!c||v)&&(c={options:C}),e={...a,params:{options:f.map((o,n)=>({text:o,value:C[n]}))}};break}case"PREDICATE":{e&&i.push(e);let f=a.params.references.split(";");e={...a,params:{references:f}};break}case"IMAGE":{e&&i.push(e),e=a;break}case"BACKGROUND":{e&&i.push(e),e=a;break}case"CHARACTER":{if(a.params.focus)switch(parseInt(a.params.focus)){case 1:{r=a.params.name;break}case 2:{r=a.params.name2;break}default:{r="";break}}else r=a.params.name;break}}}return e&&i[i.length-1]!==e&&i.push(e),t[t.length-1]!==i&&t.push(i),t},Ie={tags:{DIALOG:{enable:!0},MULTILINE:{enable:!0},DESCRIPTION:{enable:!0},SUBTITLE:{enable:!0},STICKER:{enable:!0},DECISION:{enable:!0},CHARACTER:{enable:!1},BACKGROUND:{enable:!0,type:"name"},IMAGE:{enable:!0,type:"name"}},extra:{layoutForStoryReader:!1,characterImageLookUpSheet:!1,characterNameSheet:!1,characterNameSheetWithImage:!1},sheet:{sheetName:"file"}},De=(m,t=Ie)=>{var v;const i=["DIALOG","MULTILINE","CHARACTER"],e=["IMAGE","BACKGROUND"];let c=[];for(const[o,n]of Object.entries(t.tags))n.enable&&(c.push(o),o==="DECISION"&&c.push("PREDICATE"));let r="",p="",u={},s=[],a=[],f={};const C=(o,n)=>{o in f||(f[o]=[]),n&&!f[o].includes(n)&&f[o].push(n)};for(const o of m){const n=[],A=de(o.data);t.extra.layoutForStoryReader&&(n.push(["[FILE]",o.fileName]),t.tags.CHARACTER.enable?n.push(["[LAYOUT]","","","","","[NAME]","[TEXT]"]):n.push(["[LAYOUT]","","","","[NAME]","[TEXT]"]));for(const l of A.lines)if(!(se.includes(l.tag)&&!l.params.text&&!l.params.other)&&!(l.tag==="IMAGE"&&!l.params.image)&&!(l.tag==="CHARACTER"&&!l.params.name)&&c.includes(l.tag)){let I;switch(l.tag){case"DIALOG":{I=[l.params.name,l.params.text||l.params.other],l.params.head&&(p=l.params.head),t.extra.characterNameSheet&&C(l.params.name,p);break}case"MULTILINE":{I=[l.params.name,l.params.other],t.extra.characterNameSheet&&C(l.params.name,p);break}case"DESCRIPTION":{I=["",l.params.text];break}case"SUBTITLE":{I=["",l.params.text];break}case"STICKER":{I=["",l.params.text];break}case"DECISION":{let T=l.params.options.split(";"),D=l.params.values.split(";");((v=n[n.length-1])==null?void 0:v.length)>1&&r!=="PREDICATE"&&n.push([""]);let S=["[DECISION]"],d=["[END_DECISION]"];t.tags.CHARACTER.enable&&(S.push(""),d.push("")),t.extra.layoutForStoryReader&&(S.push("[DECISION]"),d.push("[END_DECISION]")),n.push(S);for(let y=0;y<T.length;y++){let g=T[y],E=D[y],h=[`[OPTION ${E}]`,g];t.tags.CHARACTER.enable&&(h=["",...h]),t.extra.layoutForStoryReader&&(h=[`[OPTION ${E}]`,...h]),u[E]=n.length+1,n.push(h)}n.push(d);break}case"PREDICATE":{let T=l.params.references.split(";"),D=[];for(const S of T)D.push(u[S]);I=["[PREDICATE]",T.join(","),D.join(",")];break}case"IMAGE":{if(l.params.image)switch(I=["[IMAGE]"],t.tags.IMAGE.type){case"name":{I.push(l.params.image);break}case"link":{I.push(`${Z}/images/avg/imgs/${l==null?void 0:l.params.image}.webp`);break}}break}case"BACKGROUND":{let T=l.params.image||"bg_black";switch(I=["[BACKGROUND]"],t.tags.BACKGROUND.type){case"name":{I.push(T);break}case"link":{I.push(`${Z}/images/avg/imgs/${T}.webp`);break}}break}case"CHARACTER":{l.params.name?l.params.name2&&l.params.focus==="2"?p=l.params.name2.toLowerCase():p=l.params.name.toLowerCase():p="",t.extra.characterImageLookUpSheet&&!a.includes(p)&&a.push(p);break}}n.length>0&&l.tag!==r&&l.tag!=="DECISION"&&r!=="PREDICATE"&&([...i,...e].includes(l.tag)?i.includes(l.tag)&&!i.includes(r)?n.push([""]):e.includes(l.tag)&&!e.includes(r)&&n.push([""]):n.push([""])),I&&(t.tags.CHARACTER.enable&&(["DIALOG","MULTILINE"].includes(l.tag)?I=[p,...I]:I=["",...I]),t.extra.layoutForStoryReader&&(I=[`[${l.tag}]`,...I]),n.push(I)),r=l.tag}let b=o.fileName;switch(t.sheet.sheetName){case"code":{b=o.code?o.code:o.fileName;break}case"code-name":{b=o.code&&o.name?`${o.code}: ${o.name}`:o.fileName;break}}s.push({name:b,aoa:n})}return t.extra.characterImageLookUpSheet&&(s=[{name:"Characters Images Lookup",aoa:a.sort((o,n)=>o.localeCompare(n)).map(o=>[o])},...s]),t.extra.characterNameSheet&&(s=[{name:"Characters",aoa:Object.keys(f).sort((o,n)=>o.localeCompare(n)).map(o=>{let n=[o];return t.extra.characterNameSheetWithImage&&(n=[...n,...f[o]]),n})},...s]),s};export{xe as a,be as b,Oe as c,Ne as d,Ae as e,Ie as f,Se as g,De as h,Ee as m,Le as r,de as s,Te as u};
