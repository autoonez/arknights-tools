import{u as ie}from"./VBtn.57065297.js";import{q as ee,B as ue,A as ae,r as z,aj as pe,ak as ce,l as E,g as me,y as K,z as te,ai as U,n as G,a8 as fe,al as ge,am as V,an as X,ao as Y,ap as q,aq as W,ar as se,ah as Z}from"./index.b2224797.js";const M=Symbol.for("vuetify:layout"),re=Symbol.for("vuetify:layout-item"),J=1e3,xe=ee({overlaps:{type:Array,default:()=>[]},fullHeight:Boolean},"layout"),Ee=ee({name:{type:String},order:{type:[Number,String],default:0},absolute:Boolean},"layout-item");function Te(){const p=K(M);if(!p)throw new Error("[Vuetify] Could not find injected layout");return{getLayoutItem:p.getLayoutItem,mainRect:p.mainRect,mainStyles:p.mainStyles}}function be(p){var u;const a=K(M);if(!a)throw new Error("[Vuetify] Could not find injected layout");const n=(u=p.id)!=null?u:`layout-item-${ue()}`,e=ae("useLayoutItem");te(re,{id:n});const m=z(!1);pe(()=>m.value=!0),ce(()=>m.value=!1);const{layoutItemStyles:r,layoutItemScrimStyles:i}=a.register(e,{...p,active:E(()=>m.value?!1:p.active.value),id:n});return me(()=>a.unregister(n)),{layoutItemStyles:r,layoutRect:a.layoutRect,layoutItemScrimStyles:i}}const he=(p,a,n,e)=>{let m={top:0,left:0,right:0,bottom:0};const r=[{id:"",layer:{...m}}];for(const i of p){const u=a.get(i),o=n.get(i),f=e.get(i);if(!u||!o||!f)continue;const s={...m,[u.value]:parseInt(m[u.value],10)+(f.value?parseInt(o.value,10):0)};r.push({id:i,layer:s}),m=s}return r};function Se(p){const a=K(M,null),n=E(()=>a?a.rootZIndex.value-100:J),e=z([]),m=U(new Map),r=U(new Map),i=U(new Map),u=U(new Map),o=U(new Map),{resizeRef:f,contentRect:s}=ie(),g=E(()=>{var d;const h=new Map,x=(d=p.overlaps)!=null?d:[];for(const T of x.filter(I=>I.includes(":"))){const[I,b]=T.split(":");if(!e.value.includes(I)||!e.value.includes(b))continue;const S=m.get(I),A=m.get(b),k=r.get(I),$=r.get(b);!S||!A||!k||!$||(h.set(b,{position:S.value,amount:parseInt(k.value,10)}),h.set(I,{position:A.value,amount:-parseInt($.value,10)}))}return h}),v=E(()=>{const h=[...new Set([...i.values()].map(d=>d.value))].sort((d,T)=>d-T),x=[];for(const d of h){const T=e.value.filter(I=>{var b;return((b=i.get(I))==null?void 0:b.value)===d});x.push(...T)}return he(x,m,r,u)}),C=E(()=>!Array.from(o.values()).some(h=>h.value)),l=E(()=>v.value[v.value.length-1].layer),c=E(()=>({"--v-layout-left":G(l.value.left),"--v-layout-right":G(l.value.right),"--v-layout-top":G(l.value.top),"--v-layout-bottom":G(l.value.bottom),...C.value?void 0:{transition:"none"}})),L=E(()=>v.value.slice(1).map((h,x)=>{let{id:d}=h;const{layer:T}=v.value[x],I=r.get(d),b=m.get(d);return{id:d,...T,size:Number(I.value),position:b.value}})),D=h=>L.value.find(x=>x.id===h),R=ae("createLayout"),N=z(!1);fe(()=>{N.value=!0}),te(M,{register:(h,x)=>{let{id:d,order:T,position:I,layoutSize:b,elementSize:S,active:A,disableTransitions:k,absolute:$}=x;i.set(d,T),m.set(d,I),r.set(d,b),u.set(d,A),k&&o.set(d,k);const j=ge(re,R==null?void 0:R.vnode).indexOf(h);j>-1?e.value.splice(j,0,d):e.value.push(d);const _=E(()=>L.value.findIndex(w=>w.id===d)),P=E(()=>n.value+v.value.length*2-_.value*2),ne=E(()=>{const w=I.value==="left"||I.value==="right",B=I.value==="right",le=I.value==="bottom",F={[I.value]:0,zIndex:P.value,transform:`translate${w?"X":"Y"}(${(A.value?0:-110)*(B||le?-1:1)}%)`,position:$.value||n.value!==J?"absolute":"fixed",...C.value?void 0:{transition:"none"}};if(!N.value)return F;const O=L.value[_.value];if(!O)throw new Error(`[Vuetify] Could not find layout item "${d}"`);const H=g.value.get(d);return H&&(O[H.position]+=H.amount),{...F,height:w?`calc(100% - ${O.top}px - ${O.bottom}px)`:S.value?`${S.value}px`:void 0,left:B?void 0:`${O.left}px`,right:B?`${O.right}px`:void 0,top:I.value!=="bottom"?`${O.top}px`:void 0,bottom:I.value!=="top"?`${O.bottom}px`:void 0,width:w?S.value?`${S.value}px`:void 0:`calc(100% - ${O.left}px - ${O.right}px)`}}),oe=E(()=>({zIndex:P.value-1}));return{layoutItemStyles:ne,layoutItemScrimStyles:oe,zIndex:P}},unregister:h=>{i.delete(h),m.delete(h),r.delete(h),u.delete(h),o.delete(h),e.value=e.value.filter(x=>x!==h)},mainRect:l,mainStyles:c,getLayoutItem:D,items:L,layoutRect:s,rootZIndex:n});const t=E(()=>["v-layout",{"v-layout--full-height":p.fullHeight}]),y=E(()=>({zIndex:n.value,position:a?"relative":void 0,overflow:a?"hidden":void 0}));return{layoutClasses:t,layoutStyles:y,getLayoutItem:D,items:L,layoutRect:s,layoutRef:f}}const de=p=>{var m,r,i;let a={lines:[],tagCount:{},otherLines:[]},n=p.split(`
`),e=u=>{u in a.tagCount||(a.tagCount[u]=0),a.tagCount[u]+=1};for(const u of n)if(u.match(V)){let o=V.exec(u);if(o!=null&&o.groups){let{tag:f,params:s,other:g}=o.groups;f=f.toUpperCase();let v={},C;for(;(C=X.exec(s))!==null;)if(C.groups){const{name:l,value:c}=C.groups;v[l]=c.replace(/"/g,"")}g&&(v.other=g),a.lines.push({tag:f,params:v}),e(f)}}else if(u.match(Y)){let o=Y.exec(u);if(o!=null&&o.groups){let{name:f,params:s,text:g}=o.groups,v={},C;if(s)for(;(C=X.exec((m=o==null?void 0:o.groups)==null?void 0:m.params))!==null;){let l=(r=C.groups)==null?void 0:r.name,c=((i=C.groups)==null?void 0:i.value)||"";l&&(v[l]=c.replace(/"/g,""))}a.lines.push({tag:"DIALOG",params:{...v,name:f,text:g}}),e("DIALOG")}}else if(u.match(q)){let o=q.exec(u);if(o!=null&&o.groups){let{tag:f,value:s}=o.groups;f=f.toUpperCase(),a.lines.push({tag:f,params:{[f]:s}}),e(f)}}else if(u.match(W)){let o=W.exec(u);if(o!=null&&o.groups){let{tag:f}=o.groups;f=f.toUpperCase(),a.lines.push({tag:f,params:{}}),e(f)}}else if(u.length>0&&u.indexOf("//")!==0&&u!=="\r"){let o="DESCRIPTION";a.lines.push({tag:o,params:{text:u}}),e(o)}else a.otherLines.push(u);return a},Q=/\[OPTION (?<value>.*)\]/g,Ae=p=>{var n;let a={lines:[],tagCount:{},otherLines:[]};try{const e=p.find(m=>m[0]==="[LAYOUT]");if(e){const m=e.indexOf("[NAME]"),r=e.indexOf("[TEXT]");if(m&&r){for(let i=0;i<p.length;i++){const u=p[i];let o=u[0]||"";o=o.replace(/[\[\]]/g,"");const f=u[m],s=u[r];if(se.includes(o))a.lines.push({tag:o,params:{name:f,text:s}}),o in a.tagCount?a.tagCount[o]=a.tagCount[o]+1:a.tagCount[o]=1;else if(o==="DECISION"){let g=[],v=[];for(let C=i+1;C<p.length;C++){const l=p[C];if(l[0]==="[END_DECISION]"){a.lines.push({tag:"DECISION",params:{options:g.join(";"),values:v.join(";")}}),"DECISION"in a.tagCount?a.tagCount.DECISION=a.tagCount.DECISION+1:a.tagCount.DECISION=1,i=C;break}if(l[0].match(Q)){const c=Q.exec(l[0]);if(c){const L=(n=c.groups)==null?void 0:n.value;v.push(L),g.push(l[r])}}}}}return{result:a}}else return{error:"[NAME] or [TEXT] not found"}}else return{error:"[LAYOUT] not found"}}catch(e){return{error:e.message}}},Oe=({original:p,target:a})=>{let n=[],e={},m={};for(const r of a)r.tag in e||(e[r.tag]=[],m[r.tag]=0),e[r.tag].push(r);for(const r of p)if(r.tag in e)if(m[r.tag]<e[r.tag].length&&Object.keys(r.params).length>0){const i=e[r.tag][m[r.tag]],u=r;r.params.name&&i.params.name&&(u.params.name=i.params.name),r.params.text&&i.params.text&&(u.params.text=i.params.text),r.params.options&&i.params.options&&(u.params.options=i.params.options),n.push(u),m[r.tag]+=1}else n.push(r);else n.push(r);return n},Le=p=>{let a="1",n="1",e="";return p.split("#").length>1?([e,a]=p.split("#"),[a,n]=a.split("$")):p.split("$").length>1?[e,n]=p.split("$"):e=p.split("#")[0],{name:e,num:a,group:n||"1"}},Re=async p=>{var u,o;let a=[],n=[],e,m,r="",i={};for(let f=0;f<p.length;f++){let s=p[f];switch(s.tag){case"DESCRIPTION":{e?e.tag==="DESCRIPTION"?e.params.text.push(s.params.text):(n.push(e),e={tag:"DESCRIPTION",params:{text:[s.params.text]}}):e={tag:"DESCRIPTION",params:{text:[s.params.text]}};break}case"STICKER":{if(s.params.text){let g=s.params.text.replace(/\\n/g,"");e?e.tag==="STICKER"?e.params.text.push(g):(n.push(e),e={tag:"STICKER",params:{text:[g]}}):e={tag:"STICKER",params:{text:[g]}}}break}case"SUBTITLE":{s.params.text&&(e?e.tag==="SUBTITLE"?e.params.text.push(s.params.text):(n.push(e),e={tag:"SUBTITLE",params:{text:[s.params.text]}}):e={tag:"SUBTITLE",params:{text:[s.params.text]}});break}case"DIALOG":{if(!s.params.text)break;let g={...s.params,text:[s.params.text],image:r};e?e.tag==="DIALOG"&&((o=(u=e.params)==null?void 0:u.name)==null?void 0:o.localeCompare(s.params.name,void 0,{sensitivity:"base"}))===0?e.params.text.push(s.params.text):(n.push(e),e={tag:"DIALOG",params:g}):e={tag:"DIALOG",params:g};break}case"MULTILINE":{let g={tag:"DIALOG",params:{...s.params,text:[s.params.other],image:r}};e&&n.push(e),e=g;break}case"DECISION":{e&&n.push(e);let g=s.params.options.split(";"),v=s.params.values.split(";"),C=!1;if(m){for(let l of v)if(m.options.includes(l)){C=!0;break}}C&&(a.push(n),n=[],e=null),(!m||C)&&(m={options:v}),e={...s,params:{options:g.map((l,c)=>({text:l,value:v[c]}))}};break}case"PREDICATE":{e&&n.push(e);let g=s.params.references.split(";");e={...s,params:{references:g}};break}case"IMAGE":{e&&n.push(e),e=s;break}case"BACKGROUND":{e&&n.push(e),e=s;break}case"CHARACTER":{if(s.params.focus)switch(parseInt(s.params.focus)){case 1:{r=s.params.name;break}case 2:{r=s.params.name2;break}default:{r="";break}}else r=s.params.name;break}case"CHARSLOT":s.params.name&&s.params.slot&&(i[s.params.slot]=s.params.name),s.params.focus&&i[s.params.focus]&&(r=i[s.params.focus])}}return e&&n[n.length-1]!==e&&n.push(e),a[a.length-1]!==n&&a.push(n),a},Ie={tags:{DIALOG:{enable:!0},MULTILINE:{enable:!0},DESCRIPTION:{enable:!0},SUBTITLE:{enable:!0},STICKER:{enable:!0},DECISION:{enable:!0},CHARACTER:{enable:!1},BACKGROUND:{enable:!0,type:"name"},IMAGE:{enable:!0,type:"name"}},extra:{layoutForStoryReader:!1,characterImageLookUpSheet:!1,characterNameSheet:!1,characterNameSheetWithImage:!1},sheet:{sheetName:"file"}},Ne=(p,a=Ie)=>{var C;const n=["DIALOG","MULTILINE","CHARACTER","CHARSLOT"],e=["IMAGE","BACKGROUND"];let m=[];for(const[l,c]of Object.entries(a.tags))c.enable&&(m.push(l),l==="DECISION"&&m.push("PREDICATE"),l==="CHARACTER"&&m.push("CHARSLOT"));let r="",i="",u={},o={},f=[],s=[],g={};const v=(l,c)=>{l in g||(g[l]=[]),c&&!g[l].includes(c)&&g[l].push(c)};for(const l of p){const c=[],L=de(l.data);a.extra.layoutForStoryReader&&(c.push(["[FILE]",l.fileName]),a.tags.CHARACTER.enable?c.push(["[LAYOUT]","","","","","[NAME]","[TEXT]"]):c.push(["[LAYOUT]","","","","[NAME]","[TEXT]"]));for(const t of L.lines)if(!(se.includes(t.tag)&&!t.params.text&&!t.params.other)&&!(t.tag==="IMAGE"&&!t.params.image)){if(t.tag==="CHARACTER"&&!t.params.name){i="";continue}if(t.tag==="CHARSLOT"&&!t.params.name){u={};continue}if(m.includes(t.tag)){let y;switch(t.tag){case"DIALOG":{y=[t.params.name,t.params.text||t.params.other],t.params.head&&(i=t.params.head),a.extra.characterNameSheet&&v(t.params.name,i);break}case"MULTILINE":{y=[t.params.name,t.params.other],a.extra.characterNameSheet&&v(t.params.name,i);break}case"DESCRIPTION":{y=["",t.params.text];break}case"SUBTITLE":{y=["",t.params.text];break}case"STICKER":{y=["",t.params.text.replace(/\\n/g,"").replace(/<i>|<\/i>/g,"")];break}case"DECISION":{let h=t.params.options.split(";"),x=t.params.values.split(";");((C=c[c.length-1])==null?void 0:C.length)>1&&r!=="PREDICATE"&&c.push([""]);let d=["[DECISION]"],T=["[END_DECISION]"];a.tags.CHARACTER.enable&&(d.push(""),T.push("")),a.extra.layoutForStoryReader&&(d.push("[DECISION]"),T.push("[END_DECISION]")),c.push(d);for(let I=0;I<h.length;I++){let b=h[I],S=x[I],A=[`[OPTION ${S}]`,b];a.tags.CHARACTER.enable&&(A=["",...A]),a.extra.layoutForStoryReader&&(A=[`[OPTION ${S}]`,...A]),o[S]=c.length+1,c.push(A)}c.push(T);break}case"PREDICATE":{let h=t.params.references.split(";"),x=[];for(const d of h)x.push(o[d]);y=["[PREDICATE]",h.join(","),x.join(",")];break}case"IMAGE":{if(t.params.image)switch(y=["[IMAGE]"],a.tags.IMAGE.type){case"name":{y.push(t.params.image);break}case"link":{y.push(`${Z}/images/avg/imgs/${t==null?void 0:t.params.image}.webp`);break}}break}case"BACKGROUND":{let h=t.params.image||"bg_black";switch(y=["[BACKGROUND]"],a.tags.BACKGROUND.type){case"name":{y.push(h);break}case"link":{y.push(`${Z}/images/avg/bg/${h}.webp`);break}}break}case"CHARACTER":{t.params.name?(t.params.name2&&t.params.focus==="2"?i=t.params.name2.toLowerCase():i=t.params.name.toLowerCase(),i==="char_empty"&&(i="")):i="";break}case"CHARSLOT":t.params.name&&t.params.slot&&(u[t.params.slot]=t.params.name,i=t.params.name),t.params.focus&&u[t.params.focus]&&(i=u[t.params.focus])}["CHARACTER","CHARSLOT"].includes(t.tag)&&a.extra.characterImageLookUpSheet&&!s.includes(i)&&s.push(i),c.length>0&&t.tag!==r&&t.tag!=="DECISION"&&r!=="PREDICATE"&&([...n,...e].includes(t.tag)?n.includes(t.tag)&&!n.includes(r)?c.push([""]):e.includes(t.tag)&&!e.includes(r)&&c.push([""]):c.push([""])),y&&(a.tags.CHARACTER.enable&&(["DIALOG","MULTILINE"].includes(t.tag)?y=[i,...y]:y=["",...y]),a.extra.layoutForStoryReader&&(y=[`[${t.tag}]`,...y]),c.push(y)),r=t.tag}}let D=l.fileName.split("/"),R=D[D.length-1],N=R;switch(a.sheet.sheetName){case"code":{N=l.code?l.code:R;break}case"code-name":{N=l.code&&l.name?`${l.code} ${l.name}`:R;break}}f.push({name:N,aoa:c})}return a.extra.characterImageLookUpSheet&&(f=[{name:"Characters Images Lookup",aoa:s.sort((l,c)=>l.localeCompare(c)).map(l=>[l])},...f]),a.extra.characterNameSheet&&(f=[{name:"Characters",aoa:Object.keys(g).sort((l,c)=>l.localeCompare(c)).map(l=>{let c=[l];return a.extra.characterNameSheetWithImage&&(c=[...c,...g[l]]),c})},...f]),f},De=(p,a="zh_CN")=>{let n="";return p!=null&&p.code?n=`${p.code}: ${p.name[a]||p.name.zh_CN}`:n=`${p.name[a]||p.name.zh_CN}`,n};export{xe as a,Te as b,Se as c,Re as d,Ae as e,De as f,Le as g,Ie as h,Ne as i,Ee as m,Oe as r,de as s,be as u};
