import{u as fe}from"./StoryTableStore.4bf5d417.js";import{u as he}from"./CharacterStore.21685436.js";import{R as ye,C as pe,u as we}from"./CharImageDialog.aac4bcde.js";import{d as W,l as y,a2 as x,_ as X,c as B,w as k,o as b,a as g,a3 as Y,a4 as te,b as ae,a5 as oe,U as H,r as V,a6 as Se,a7 as ne,f as le,I as be,n as A,a8 as z,h as N,g as re,a9 as ke,m as Ve,j as Te,k as Le,x as G,aa as Ce,u as $e,Q as Be,p as _e,F as Re,T as Ee,ab as O,ac as Me,ad as P}from"./index.6b9e8a8c.js";import{u as se}from"./StoryReaderStore.fbe6f9c1.js";import{V as De}from"./VDialog.83b7dde4.js";import{V as ue,a as ie,c as Ie}from"./VList.5a772bef.js";import{a as Ae,t as Ne,b as He}from"./VCard.a49de1ad.js";import{u as ce,h as Pe,j as xe,d as Ye,m as Oe,n as We,f as J,r as Xe,g as ze,x as Ue}from"./router.93217040.js";import{m as Fe,u as Ze}from"./story-service.3929371a.js";import{u as je,V as qe}from"./ssrBoot.98047e2b.js";import{V as Qe,a as Ge,b as Je}from"./VMain.01602086.js";import{V as de}from"./VBtn.227333b8.js";import{V as Ke}from"./VContainer.817795df.js";import"./VRow.929b502b.js";/* empty css              */import"./forwardRefs.e48194d2.js";import"./index.dbfb4d3b.js";const et=W({name:"LanguageSelectorDialog",props:{options:{type:Array,default:()=>[]}},emits:["selectLanguage"],setup(e){return{languageOptions:y(()=>x.filter(u=>{var o;return(o=e.options)==null?void 0:o.includes(u.id)}))}}});function tt(e,t,u,o,l,a){return b(),B(De,null,{default:k(()=>[g(Ae,null,{default:k(()=>[g(ue,null,{default:k(()=>[(b(!0),Y(H,null,te(e.languageOptions,r=>(b(),B(ie,{key:r.id,onClick:s=>e.$emit("selectLanguage",r.id)},{default:k(()=>[ae(oe(r.name),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1})]),_:1})}const at=X(et,[["render",tt]]),ot=W({namme:"StoryReaderAppBar",setup(){const e=ne(),t=se(),u=V(!1),o=V(!1),l=y(()=>t.storySet),a=y(()=>t.story),r=y(()=>{let m=[];return e.name==="render-story"?a&&(m=x.filter(i=>{var n;return a.value?i.id in((n=a.value)==null?void 0:n.name):!1}).map(i=>i.id)):e.name==="select-story"?l&&(m=x.filter(i=>{var n;return l.value?i.id in((n=l.value)==null?void 0:n.name):!1}).map(i=>i.id)):m=x.map(i=>i.id),m});return{drawer:u,selectLanguageDialog:o,availableLanguages:r,selectLanguage:m=>{t.setLanguage(m),o.value=!1},storyType:Se}},components:{LanguageSelectorDialog:at}}),nt=le({name:"VAppBarNavIcon",props:{icon:{type:be,default:"$menu"}},setup(e,t){let{slots:u}=t;return ce(()=>g(de,{class:"v-app-bar-nav-icon",icon:e.icon},u)),{}}});function lt(e){let{rootEl:t,isSticky:u,layoutItemStyles:o}=e;const l=V(!1),a=V(0),r=y(()=>{const i=typeof l.value=="boolean"?"top":l.value;return[u.value?{top:"auto",bottom:"auto",height:void 0}:void 0,l.value?{[i]:A(a.value)}:{top:o.value.top}]});z(()=>{N(u,i=>{i?window.addEventListener("scroll",m,{passive:!0}):window.removeEventListener("scroll",m)},{immediate:!0})}),re(()=>{document.removeEventListener("scroll",m)});let s=0;function m(){var $;const i=s>window.scrollY?"up":"down",n=t.value.getBoundingClientRect(),p=parseFloat(($=o.value.top)!=null?$:0),h=window.scrollY-Math.max(0,a.value-p),d=n.height+Math.max(a.value,p)-window.scrollY-window.innerHeight;n.height<window.innerHeight-p?(l.value="top",a.value=p):i==="up"&&l.value==="bottom"||i==="down"&&l.value==="top"?(a.value=window.scrollY+n.top,l.value=!0):i==="down"&&d<=0?(a.value=0,l.value="bottom"):i==="up"&&h<=0&&(a.value=n.top+h,l.value="top"),s=window.scrollY}return{isStuck:l,stickyStyles:r}}const rt=100,st=20;function K(e){const t=1.41421356237;return(e<0?-1:1)*Math.sqrt(Math.abs(e))*t}function ee(e){if(e.length<2)return 0;if(e.length===2)return e[1].t===e[0].t?0:(e[1].d-e[0].d)/(e[1].t-e[0].t);let t=0;for(let u=e.length-1;u>0;u--){if(e[u].t===e[u-1].t)continue;const o=K(t),l=(e[u].d-e[u-1].d)/(e[u].t-e[u-1].t);t+=(l-o)*Math.abs(l),u===e.length-1&&(t*=.5)}return K(t)*1e3}function ut(){const e={};function t(l){Array.from(l.changedTouches).forEach(a=>{var s;((s=e[a.identifier])!=null?s:e[a.identifier]=new ke(st)).push([l.timeStamp,a])})}function u(l){Array.from(l.changedTouches).forEach(a=>{delete e[a.identifier]})}function o(l){var a;const r=(a=e[l])==null?void 0:a.values().reverse();if(!r)throw new Error(`No samples for touch id ${l}`);const s=r[0],m=[],i=[];for(const n of r){if(s[0]-n[0]>rt)break;m.push({t:n[0],d:n[1].clientX}),i.push({t:n[0],d:n[1].clientY})}return{x:ee(m),y:ee(i),get direction(){const{x:n,y:p}=this,[h,d]=[Math.abs(n),Math.abs(p)];return h>d&&n>=0?"right":h>d&&n<=0?"left":d>h&&p>=0?"down":d>h&&p<=0?"up":it()}}}return{addMovement:t,endTouch:u,getVelocity:o}}function it(){throw new Error}function ct(e){let{isActive:t,isTemporary:u,width:o,touchless:l,position:a}=e;z(()=>{window.addEventListener("touchstart",M,{passive:!0}),window.addEventListener("touchmove",R,{passive:!1}),window.addEventListener("touchend",T,{passive:!0})}),re(()=>{window.removeEventListener("touchstart",M),window.removeEventListener("touchmove",R),window.removeEventListener("touchend",T)});const r=y(()=>a.value!=="bottom"),{addMovement:s,endTouch:m,getVelocity:i}=ut();let n=!1;const p=V(!1),h=V(0),d=V(0);let $;function E(c,v){return(a.value==="left"?c:a.value==="right"?document.documentElement.clientWidth-c:a.value==="bottom"?document.documentElement.clientHeight-c:D())-(v?o.value:0)}function _(c){let v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;const f=a.value==="left"?(c-d.value)/o.value:a.value==="right"?(document.documentElement.clientWidth-c-d.value)/o.value:a.value==="bottom"?(document.documentElement.clientHeight-c-d.value)/o.value:D();return v?Math.max(0,Math.min(1,f)):f}function M(c){if(l.value)return;const v=c.changedTouches[0].clientX,f=c.changedTouches[0].clientY,w=25,C=a.value==="left"?v<w:a.value==="right"?v>document.documentElement.clientWidth-w:a.value==="bottom"?f>document.documentElement.clientHeight-w:D(),S=t.value&&(a.value==="left"?v<o.value:a.value==="right"?v>document.documentElement.clientWidth-o.value:a.value==="bottom"?f>document.documentElement.clientHeight-o.value:D());(C||S||t.value&&u.value)&&(n=!0,$=[v,f],d.value=E(r.value?v:f,t.value),h.value=_(r.value?v:f),m(c),s(c))}function R(c){const v=c.changedTouches[0].clientX,f=c.changedTouches[0].clientY;if(n){if(!c.cancelable){n=!1;return}const C=Math.abs(v-$[0]),S=Math.abs(f-$[1]);(r.value?C>S&&C>3:S>C&&S>3)?(p.value=!0,n=!1):(r.value?S:C)>3&&(n=!1)}if(!p.value)return;c.preventDefault(),s(c);const w=_(r.value?v:f,!1);h.value=Math.max(0,Math.min(1,w)),w>1?d.value=E(r.value?v:f,!0):w<0&&(d.value=E(r.value?v:f,!1))}function T(c){if(n=!1,!p.value)return;s(c),p.value=!1;const v=i(c.changedTouches[0].identifier),f=Math.abs(v.x),w=Math.abs(v.y);(r.value?f>w&&f>400:w>f&&w>3)?t.value=v.direction===({left:"right",right:"left",bottom:"up"}[a.value]||D()):t.value=h.value>.5}const I=y(()=>p.value?{transform:a.value==="left"?`translateX(calc(-100% + ${h.value*o.value}px))`:a.value==="right"?`translateX(calc(100% - ${h.value*o.value}px))`:a.value==="bottom"?`translateY(calc(100% - ${h.value*o.value}px))`:D(),transition:"none"}:void 0);return{isDragging:p,dragProgress:h,dragStyles:I}}function D(){throw new Error}const dt=["start","end","left","right","bottom"],vt=le({name:"VNavigationDrawer",props:{color:String,disableResizeWatcher:Boolean,disableRouteWatcher:Boolean,expandOnHover:Boolean,floating:Boolean,modelValue:{type:Boolean,default:null},permanent:Boolean,rail:Boolean,railWidth:{type:[Number,String],default:56},scrim:{type:[String,Boolean],default:!0},image:String,temporary:Boolean,touchless:Boolean,width:{type:[Number,String],default:256},location:{type:String,default:"start",validator:e=>dt.includes(e)},sticky:Boolean,...Pe(),...xe(),...Fe(),...Ye(),...Oe({tag:"nav"}),...Ve()},emits:{"update:modelValue":e=>!0},setup(e,t){let{attrs:u,slots:o}=t;const{isRtl:l}=Te(),{themeClasses:a}=Le(e),{borderClasses:r}=We(e),{backgroundColorClasses:s,backgroundColorStyles:m}=J(G(e,"color")),{elevationClasses:i}=Xe(e),{mobile:n}=Ce(),{roundedClasses:p}=ze(e),h=Ue(),d=$e(e,"modelValue",null,L=>!!L),{ssrBootStyles:$}=je(),E=V(),_=V(!1),M=y(()=>e.rail&&e.expandOnHover&&_.value?Number(e.width):Number(e.rail?e.railWidth:e.width)),R=y(()=>Ne(e.location,l.value)),T=y(()=>!e.permanent&&(n.value||e.temporary)),I=y(()=>e.sticky&&!T.value&&R.value!=="bottom");e.disableResizeWatcher||N(T,L=>!e.permanent&&(d.value=!L)),!e.disableRouteWatcher&&h&&N(h.currentRoute,()=>T.value&&(d.value=!1)),N(()=>e.permanent,L=>{L&&(d.value=!0)}),Be(()=>{e.modelValue!=null||T.value||(d.value=e.permanent||!n.value)});const{isDragging:c,dragProgress:v,dragStyles:f}=ct({isActive:d,isTemporary:T,width:M,touchless:G(e,"touchless"),position:R}),w=y(()=>{const L=T.value?0:e.rail&&e.expandOnHover?Number(e.railWidth):M.value;return c.value?L*v.value:L}),{layoutItemStyles:C,layoutRect:S,layoutItemScrimStyles:U}=Ze({id:e.name,order:y(()=>parseInt(e.order,10)),position:R,layoutSize:w,elementSize:M,active:y(()=>d.value||c.value),disableTransitions:y(()=>c.value),absolute:y(()=>e.absolute||I.value&&typeof F.value!="string")}),{isStuck:F,stickyStyles:ve}=lt({rootEl:E,isSticky:I,layoutItemStyles:C}),Z=J(y(()=>typeof e.scrim=="string"?e.scrim:null)),me=y(()=>({...c.value?{opacity:v.value*.2,transition:"none"}:void 0,...S.value?{left:A(S.value.left),right:A(S.value.right),top:A(S.value.top),bottom:A(S.value.bottom)}:void 0,...U.value}));return _e({VList:{bgColor:"transparent"}}),ce(()=>{var L,j,q,Q;const ge=o.image||e.image;return g(H,null,[g(e.tag,Re({ref:E,onMouseenter:()=>_.value=!0,onMouseleave:()=>_.value=!1,class:["v-navigation-drawer",`v-navigation-drawer--${R.value}`,{"v-navigation-drawer--expand-on-hover":e.expandOnHover,"v-navigation-drawer--floating":e.floating,"v-navigation-drawer--is-hovering":_.value,"v-navigation-drawer--rail":e.rail,"v-navigation-drawer--temporary":T.value,"v-navigation-drawer--active":d.value,"v-navigation-drawer--sticky":I.value},a.value,s.value,r.value,i.value,p.value],style:[m.value,C.value,f.value,$.value,ve.value]},u),{default:()=>[ge&&g("div",{key:"image",class:"v-navigation-drawer__img"},[o.image?(L=o.image)==null?void 0:L.call(o,{image:e.image}):g("img",{src:e.image,alt:""},null)]),o.prepend&&g("div",{class:"v-navigation-drawer__prepend"},[(j=o.prepend)==null?void 0:j.call(o)]),g("div",{class:"v-navigation-drawer__content"},[(q=o.default)==null?void 0:q.call(o)]),o.append&&g("div",{class:"v-navigation-drawer__append"},[(Q=o.append)==null?void 0:Q.call(o)])]}),g(Ee,{name:"fade-transition"},{default:()=>[T.value&&(c.value||d.value)&&!!e.scrim&&g("div",{class:["v-navigation-drawer__scrim",Z.backgroundColorClasses.value],style:[me.value,Z.backgroundColorStyles.value],onClick:()=>d.value=!1},null)]})])}),{isStuck:F}}});function mt(e,t,u,o,l,a){const r=O("LanguageSelectorDialog");return b(),Y(H,null,[g(vt,{modelValue:e.drawer,"onUpdate:modelValue":t[0]||(t[0]=s=>e.drawer=s),bottom:"",temporary:""},{default:k(()=>[g(ue,null,{default:k(()=>[(b(!0),Y(H,null,te(e.storyType,(s,m)=>(b(),B(ie,{key:m,to:{name:s.routeName}},{default:k(()=>[g(Ie,null,{default:k(()=>[ae(oe(s.name),1)]),_:2},1024)]),_:2},1032,["to"]))),128))]),_:1})]),_:1},8,["modelValue"]),g(Qe,{density:"compact"},{default:k(()=>[g(nt,{variant:"text",onClick:t[1]||(t[1]=Me(s=>e.drawer=!e.drawer,["stop"]))}),g(qe),g(de,{variant:"text",icon:"mdi-translate",onClick:t[2]||(t[2]=s=>e.selectLanguageDialog=!0)})]),_:1}),g(r,{modelValue:e.selectLanguageDialog,"onUpdate:modelValue":t[3]||(t[3]=s=>e.selectLanguageDialog=s),options:e.availableLanguages,onSelectLanguage:e.selectLanguage},null,8,["modelValue","options","onSelectLanguage"])],64)}const gt=X(ot,[["render",mt]]),ft=W({name:"StoryReader",components:{RenderBlock:ye,CharImageDialog:pe,StoryReaderAppBar:gt},setup(){const e=ne(),t=se(),{getStoryTable:u,getStoryList:o}=fe(),{getCharacterTable:l}=he(),{getCharacterSpriteTable:a}=we(),r=V(!0),s=V(!1),m=V([]),i=async()=>{r.value=!0;try{await u(),await o(),await l(),await a()}catch(n){m.value.push(n)}finally{r.value=!1,s.value=!0}};return z(async()=>{await i(),N(()=>[e.name,t.storySet,t.story],()=>{if(e.name==="select-story")if(t.storySet){let n=t.storySet.name[t.language||"zh_CN"];n?document.title=n:document.title="Arknights Tools | Story Reader"}else document.title="Arknights Tools | Story Reader";else if(e.name==="render-story"){if(t.story){let n=t.getStoryTitle(t.story.storyId);n?document.title=n:document.title="Arknights Tools | Story Reader"}}else document.title="Arknights Tools | Story Reader"},{immediate:!0})}),{loading:r,ready:s,errors:m,route:e}}});function ht(e,t,u,o,l,a){const r=O("StoryReaderAppBar"),s=O("router-view");return b(),B(Ge,null,{default:k(()=>[e.loading?(b(),B(He,{key:0,indeterminate:""})):P("",!0),g(r),g(Je,null,{default:k(()=>[e.route.name!=="render-story"?(b(),B(Ke,{key:0},{default:k(()=>[e.ready?(b(),B(s,{key:0})):P("",!0)]),_:1})):e.route.name==="render-story"?(b(),Y(H,{key:1},[e.ready?(b(),B(s,{key:0})):P("",!0)],64)):P("",!0)]),_:1})]),_:1})}const At=X(ft,[["render",ht]]);export{At as default};
