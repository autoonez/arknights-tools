import{d as T,h as m,_ as R,c as f,w as d,o as c,f as i,i as $,r as E,b as B,t as N,F as C,aF as q,j as p,e as X,m as ee,aO as te,n as I,v as oe,x as O,J as k,B as se,aP as re,L as V}from"./index.af01303f.js";import{u as D,H as G,a as ae}from"./StoryReaderStore.6789030f.js";import{R as ne,C as le,s as A,a as z,b as ie,r as ue}from"./CharImageDialog.f64f1642.js";import{u as ce}from"./StoryTableStore.df7801a2.js";import{V as U}from"./VDialog.e858caa7.js";import{V as H,a as J,b as Q,c as de}from"./VList.f95ed554.js";import{V as Y,a as ye}from"./VCard.01af00f6.js";import{m as me,j as Se,a as ve,b as fe,c as ge,u as he,r as pe,d as _e,e as ke,g as $e}from"./router.da5ed236.js";import{b as Ce,u as be,c as Ve,V as _}from"./VBtn.6f709d3f.js";import{m as Be,u as Ne}from"./layout.561985f9.js";import{m as Te}from"./tag.49f72dba.js";import{u as Re}from"./useRender.d6870f84.js";import{V as De}from"./VContainer.490a7826.js";import"./VRow.f23ef9f5.js";/* empty css              */import"./forwardRefs.54bd1271.js";import"./index.74147b0e.js";import"./resizeObserver.d901d395.js";const Ie=T({name:"StorySelectorDialog",emits:["selectStory"],setup(){const e=D();return{storySet:m(()=>e.storySet),getStoryTitle:o=>e.getStoryTitle(o)}}});function we(e,t,r,o,u,S){return c(),f(U,null,{default:d(()=>[i(Y,null,{default:d(()=>[i(H,null,{default:d(()=>{var s;return[(c(!0),$(C,null,E((s=e.storySet)==null?void 0:s.story,(a,v,n)=>(c(),f(J,{key:n,onClick:l=>e.$emit("selectStory",v)},{default:d(()=>[i(Q,null,{default:d(()=>[B(N(e.getStoryTitle(v.toString())),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]}),_:1})]),_:1})]),_:1})}const Pe=R(Ie,[["render",we]]),Le=T({name:"StoryRenderBottomNav",setup(){const e=q(),t=p(!1),r=D(),o=m(()=>r.storySet),u=m(()=>r.story),S=m(()=>{let n="";return o.value&&u.value&&(u.value.code?n=`${u.value.code}: ${u.value.name[r.language]}`:n=`${u.value.name[r.language]}`),n});return{dialog:t,storyTitle:S,selectPreviousStory:()=>{var n;if(o.value){const l=Object.values((n=o.value)==null?void 0:n.story).find(y=>u.value?y.sort===u.value.sort-1:!1);l&&e.push({name:"render-story",query:{storyFile:l.file,storySetId:o.value.id}})}},selectNextStory:()=>{var n;if(o.value){const l=Object.values((n=o.value)==null?void 0:n.story).find(y=>u.value?y.sort===u.value.sort+1:!1);l&&e.push({name:"render-story",query:{storyFile:l.file,storySetId:o.value.id}})}},selectStory:n=>{if(t.value=!1,o.value){const l=o.value.story[n];e.push({name:"render-story",query:{storyFile:l.file,storySetId:o.value.id}})}}}},components:{StorySelectorDialog:Pe}});const x=X({name:"VBottomNavigation",props:{bgColor:String,color:String,grow:Boolean,mode:{type:String,validator:e=>!e||["horizontal","shift"].includes(e)},height:{type:[Number,String],default:56},...me(),...Se(),...ve(),...fe(),...Be({name:"bottom-navigation"}),...Te({tag:"header"}),...Ce({modelValue:!0,selectedClass:"v-btn--selected"}),...ee()},emits:{"update:modelValue":e=>!0},setup(e,t){let{slots:r}=t;const{themeClasses:o}=te(),{borderClasses:u}=ge(e),{backgroundColorClasses:S,backgroundColorStyles:s}=he(I(e,"bgColor")),{densityClasses:a}=pe(e),{elevationClasses:v}=_e(e),{roundedClasses:n}=ke(e),l=m(()=>Number(e.height)-(e.density==="comfortable"?8:0)-(e.density==="compact"?16:0)),y=$e(e,"modelValue",e.modelValue),{layoutItemStyles:g}=Ne({id:e.name,order:m(()=>parseInt(e.order,10)),position:m(()=>"bottom"),layoutSize:m(()=>y.value?l.value:0),elementSize:l,active:y,absolute:I(e,"absolute")});return be(e,Ve),oe({VBtn:{color:I(e,"color"),density:I(e,"density"),stacked:m(()=>e.mode!=="horizontal"),variant:"text"}},{scoped:!0}),Re(()=>i(e.tag,{class:["v-bottom-navigation",{"v-bottom-navigation--active":y.value,"v-bottom-navigation--grow":e.grow,"v-bottom-navigation--shift":e.mode==="shift"},o.value,S.value,u.value,a.value,v.value,n.value],style:[s.value,g.value,{height:O(l.value),transform:`translateY(${O(y.value?0:100,"%")})`}]},{default:()=>[r.default&&i("div",{class:"v-bottom-navigation__content"},[r.default()])]})),{}}});function Fe(e,t,r,o,u,S){const s=k("StorySelectorDialog");return c(),$(C,null,[i(s,{modelValue:e.dialog,"onUpdate:modelValue":t[0]||(t[0]=a=>e.dialog=a),onSelectStory:e.selectStory},null,8,["modelValue","onSelectStory"]),i(x,{density:"compact"},{default:d(()=>[i(_,{icon:"mdi-chevron-left",onClick:e.selectPreviousStory},null,8,["onClick"]),i(_,{variant:"text",class:"story-title-btn",onClick:t[1]||(t[1]=a=>e.dialog=!0)},{default:d(()=>[B(N(e.storyTitle),1)]),_:1}),i(_,{icon:"mdi-chevron-right",onClick:e.selectNextStory},null,8,["onClick"])]),_:1})],64)}const Ge=R(Le,[["render",Fe],["__scopeId","data-v-f1ff141a"]]),ze=T({name:"StorySelectorDialogGoogleSheets",emits:["selectStory"],setup(){const e=D(),t=m(()=>e.spreadsheet),r=m(()=>{var o;return((o=t.value)==null?void 0:o.sheets)||[]});return{spreadsheet:t,sheets:r}}});function Ee(e,t,r,o,u,S){return c(),f(U,null,{default:d(()=>[i(Y,null,{default:d(()=>{var s;return[i(_,{variant:"text",href:(s=e.spreadsheet)==null?void 0:s.url},{default:d(()=>{var a;return[B(N(((a=e.spreadsheet)==null?void 0:a.title)||""),1)]}),_:1},8,["href"]),i(de),i(H,null,{default:d(()=>[(c(!0),$(C,null,E(e.sheets,(a,v)=>(c(),f(J,{key:v,onClick:n=>e.$emit("selectStory",v)},{default:d(()=>[i(Q,null,{default:d(()=>[B(N(a),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})]}),_:1})]),_:1})}const je=R(ze,[["render",Ee]]),Oe=T({name:"StoryRenderBottomNavGoogleSheets",setup(){const e=p(!1),t=D(),r=m(()=>t.spreadsheet?t.spreadsheet.sheets[t.spreadsheet.currentSheet]:"");return{dialog:e,storyTitle:r,selectPreviousStory:()=>{var s;if(t.spreadsheet){const a=(s=t.spreadsheet)==null?void 0:s.sheets[t.spreadsheet.currentSheet-1];t.spreadsheet.currentSheet>0&&a&&t.setSpreadsheetCurrentSheet(t.spreadsheet.currentSheet-1)}},selectNextStory:()=>{var s;t.spreadsheet&&((s=t.spreadsheet)==null?void 0:s.sheets[t.spreadsheet.currentSheet+1])&&t.setSpreadsheetCurrentSheet(t.spreadsheet.currentSheet+1)},selectStory:s=>{e.value=!1,t.setSpreadsheetCurrentSheet(s)}}},components:{StorySelectorDialogGoogleSheets:je}});function Ae(e,t,r,o,u,S){const s=k("StorySelectorDialogGoogleSheets");return c(),$(C,null,[i(s,{modelValue:e.dialog,"onUpdate:modelValue":t[0]||(t[0]=a=>e.dialog=a),onSelectStory:e.selectStory},null,8,["modelValue","onSelectStory"]),i(x,{density:"compact"},{default:d(()=>[i(_,{icon:"mdi-chevron-left",onClick:e.selectPreviousStory},null,8,["onClick"]),i(_,{variant:"text",class:"story-title-btn",onClick:t[1]||(t[1]=a=>e.dialog=!0)},{default:d(()=>[B(N(e.storyTitle),1)]),_:1}),i(_,{icon:"mdi-chevron-right",onClick:e.selectNextStory},null,8,["onClick"])]),_:1})],64)}const qe=R(Oe,[["render",Ae],["__scopeId","data-v-88119425"]]),Ue=T({name:"StoryRender",props:["storyFile","storySetId","type"],components:{RenderBlock:ne,CharImageDialog:le,StoryRenderBottomNav:Ge,StoryRenderBottomNavGoogleSheets:qe},setup(e){const t=q(),r=D(),{storyTable:o,storyList:u}=ce(),S=p(!1),s=p(!1),a=p([]),v=p(""),n=m(()=>r.language),l=m(()=>r.storySet),y=p([]);return se(()=>{var g;return[e.storyFile,e.storySetId,e.type,n.value,(g=r.spreadsheet)==null?void 0:g.currentSheet]},async()=>{var g;try{if(S.value=!0,e.type==="original"){e.storySetId&&r.setStorySet(o==null?void 0:o.story[e.storySetId]),e.storyFile||(l.value?t.push({name:re[l.value.type].routeName||"select-story-type"}):t.push({name:"select-story-type"})),l.value&&r.setStory(Object.values(l.value.story).find(j=>j.file===e.storyFile));const w=(await G.get(`/story/${n.value}/${e.storyFile}.txt`)).data,P=A(w);y.value=await z(P.lines),s.value=!0,window.scrollTo(0,0)}else if(e.type==="spreadsheet")if(r.spreadsheet){const{id:h,sheets:w,currentSheet:P}=r.spreadsheet,L=(g=(await G.get(`https://sheets.googleapis.com/v4/spreadsheets/${h}/values/'${w[P]}'`,{params:{key:"AIzaSyDu129ufi2q02ZHJhoLYsO_0ew6nh9kQAQ"}})).data)==null?void 0:g.values,b=ie(L);if(!b.error)if(L[0][0]==="[FILE]"){const M=L[0][1],Z=u.find(F=>F.includes(M)),K=(await G.get(`/story/zh_CN/${Z}`)).data,W=A(K);if(b.result){const F=ue({original:W.lines,target:b.result.lines});y.value=await z(F),s.value=!0,window.scrollTo(0,0)}}else b.result&&(y.value=await z(b.result.lines),s.value=!0,window.scrollTo(0,0))}else t.push({name:"google-sheets"});else t.push({name:"select-story-type"})}catch(h){h instanceof ae.exports.AxiosError&&n.value!=="zh_CN"&&(h==null?void 0:h.code)==="ERR_BAD_REQUEST"?r.setLanguage("zh_CN"):a.value.push(h)}finally{S.value=!1}},{immediate:!0}),{loading:S,ready:s,charImage:v,errors:a,storySet:l,renderBlocks:y}}});function He(e,t,r,o,u,S){const s=k("RenderBlock"),a=k("StoryRenderBottomNav"),v=k("StoryRenderBottomNavGoogleSheets"),n=k("CharImageDialog");return c(),$(C,null,[e.loading?(c(),f(ye,{key:0,indeterminate:""})):V("",!0),e.ready?(c(),f(De,{key:1},{default:d(()=>[(c(!0),$(C,null,E(e.renderBlocks,(l,y)=>(c(),f(s,{key:y,"render-block":l,onSelectCharImage:t[0]||(t[0]=g=>{e.charImage=g})},null,8,["render-block"]))),128))]),_:1})):V("",!0),e.type==="original"?(c(),f(a,{key:2})):V("",!0),e.type==="spreadsheet"?(c(),f(v,{key:3})):V("",!0),e.ready?(c(),f(n,{key:4,"char-image":e.charImage,onCloseDialog:t[1]||(t[1]=l=>e.charImage="")},null,8,["char-image"])):V("",!0)],64)}const ct=R(Ue,[["render",He]]);export{ct as default};
