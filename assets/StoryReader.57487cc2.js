var aa=Object.defineProperty,na=Object.defineProperties;var sa=Object.getOwnPropertyDescriptors;var me=Object.getOwnPropertySymbols;var Je=Object.prototype.hasOwnProperty,Qe=Object.prototype.propertyIsEnumerable;var Ze=(e,t,a)=>t in e?aa(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,h=(e,t)=>{for(var a in t||(t={}))Je.call(t,a)&&Ze(e,a,t[a]);if(me)for(var a of me(t))Qe.call(t,a)&&Ze(e,a,t[a]);return e},x=(e,t)=>na(e,sa(t));var et=(e,t)=>{var a={};for(var s in e)Je.call(e,s)&&t.indexOf(s)<0&&(a[s]=e[s]);if(e!=null&&me)for(var s of me(e))t.indexOf(s)<0&&Qe.call(e,s)&&(a[s]=e[s]);return a};import{d as Z,c as u,m as te,T as ve,a as $e,b as ie,e as C,h as St,f as X,_ as w,o as f,g as p,w as g,i as S,r as F,V as oe,j as R,t as $,k as pe,F as E,l as ce,n as Q,p as ee,q as z,s as I,u as ra,v as la,x as Ve,y as ia,z as Ct,R as oa,A as _e,B as Et,C as ca,D as Se,E as Tt,G as bt,H as Ne,I as ua,J as da,K as Ce,L as xt,M as ma,N as fa,O as Ee,P as kt,Q as It,S as Me,U as va,W as ge,X as Rt,Y as ga,Z as xe,$ as He,a0 as tt,a1 as ue,a2 as W,a3 as V,a4 as Te,a5 as ae,a6 as ya,a7 as wt,a8 as j,a9 as be,aa as ne,ab as ha,ac as k,ad as pa,ae as _a,af as Sa,ag as Ca,ah as Ea,ai as Ta,aj as Ot,ak as Lt,al as Fe,am as At,an as ye,ao as ba,ap as xa,aq as ka,ar as Ia,as as Ra,at as wa,au as D,av as Oa,aw as ke,ax as at,ay as we,az as Dt,aA as La,aB as Aa,aC as Da}from"./index.b9348666.js";class fe{constructor(t){let{x:a,y:s,width:n,height:r}=t;this.x=a,this.y=s,this.width=n,this.height=r}get top(){return this.y}get bottom(){return this.y+this.height}get left(){return this.x}get right(){return this.x+this.width}}function Pt(e){const t=e.getBoundingClientRect(),a=getComputedStyle(e),s=a.transform;if(s){let n,r,l,o,i;if(s.startsWith("matrix3d("))n=s.slice(9,-1).split(/, /),r=+n[0],l=+n[5],o=+n[12],i=+n[13];else if(s.startsWith("matrix("))n=s.slice(7,-1).split(/, /),r=+n[0],l=+n[3],o=+n[4],i=+n[5];else return new fe(t);const c=a.transformOrigin,d=t.x-o-(1-r)*parseFloat(c),v=t.y-i-(1-l)*parseFloat(c.slice(c.indexOf(" ")+1)),m=r?t.width/r:e.offsetWidth,_=l?t.height/l:e.offsetHeight;return new fe({x:d,y:v,width:m,height:_})}else return new fe(t)}function Bt(e){if(typeof e.getRootNode!="function"){for(;e.parentNode;)e=e.parentNode;return e!==document?null:document}const t=e.getRootNode();return t!==document&&t.getRootNode({composed:!0})!==document?null:t}const Pa="cubic-bezier(0.4, 0, 0.2, 1)",Ba="cubic-bezier(0.0, 0, 0.2, 1)",$a="cubic-bezier(0.4, 0, 1, 1)";function $t(e){for(;e;){if(Ye(e))return e;e=e.parentElement}return document.scrollingElement}function Oe(e){const t=[];for(;e;)Ye(e)&&t.push(e),e=e.parentElement;return t}function Ye(e){if(!e||e.nodeType!==Node.ELEMENT_NODE)return!1;const t=window.getComputedStyle(e);return t.overflowY==="scroll"||t.overflowY==="auto"&&e.scrollHeight>e.clientHeight}function Va(e){for(;e;){if(window.getComputedStyle(e).position==="fixed")return!0;e=e.offsetParent}return!1}const Na=Z({name:"VDialogTransition",props:{target:Object},setup(e,t){let{slots:a}=t;const s={onBeforeEnter(n){n.style.pointerEvents="none"},async onEnter(n,r){await new Promise(c=>requestAnimationFrame(c));const{x:l,y:o}=nt(e.target,n);n.animate([{transform:`translate(${l}px, ${o}px) scale(0.1)`,opacity:0},{transform:""}],{duration:225,easing:Ba}).finished.then(()=>r())},onAfterEnter(n){n.style.removeProperty("pointer-events")},onBeforeLeave(n){n.style.pointerEvents="none"},async onLeave(n,r){await new Promise(c=>requestAnimationFrame(c));const{x:l,y:o}=nt(e.target,n);n.animate([{transform:""},{transform:`translate(${l}px, ${o}px) scale(0.1)`,opacity:0}],{duration:125,easing:$a}).finished.then(()=>r())},onAfterLeave(n){n.style.removeProperty("pointer-events")}};return()=>e.target?u(ve,te({name:"dialog-transition"},s,{css:!1}),a):u(ve,{name:"dialog-transition"},a)}});function nt(e,t){const a=e.getBoundingClientRect(),s=Pt(t),[n,r]=getComputedStyle(t).transformOrigin.split(" ").map(d=>parseFloat(d)),[l,o]=getComputedStyle(t).getPropertyValue("--v-overlay-anchor-origin").split(" ");let i=a.left+a.width/2;l==="left"||o==="left"?i-=a.width/2:(l==="right"||o==="right")&&(i+=a.width/2);let c=a.top+a.height/2;return l==="top"||o==="top"?c-=a.height/2:(l==="bottom"||o==="bottom")&&(c+=a.height/2),{x:i-(n+s.left),y:c-(r+s.top)}}const je=["sm","md","lg","xl","xxl"],Vt=(()=>je.reduce((e,t)=>(e[t]={type:[Boolean,String,Number],default:!1},e),{}))(),Nt=(()=>je.reduce((e,t)=>(e["offset"+$e(t)]={type:[String,Number],default:null},e),{}))(),Mt=(()=>je.reduce((e,t)=>(e["order"+$e(t)]={type:[String,Number],default:null},e),{}))(),st={col:Object.keys(Vt),offset:Object.keys(Nt),order:Object.keys(Mt)};function Ma(e,t,a){let s=e;if(!(a==null||a===!1))return t&&(s+=`-${t.replace(e,"")}`),e==="col"&&(s="v-"+s),e==="col"&&(a===""||a===!0)||(s+=`-${a}`),s.toLowerCase()}const Le=Z({name:"VCol",props:h(x(h(x(h(x(h({cols:{type:[Boolean,String,Number],default:!1}},Vt),{offset:{type:[String,Number],default:null}}),Nt),{order:{type:[String,Number],default:null}}),Mt),{alignSelf:{type:String,default:null,validator:e=>["auto","start","end","center","baseline","stretch"].includes(e)}}),ie()),setup(e,t){let{slots:a}=t;const s=C(()=>{const n=[];let r;for(r in st)st[r].forEach(o=>{const i=e[o],c=Ma(r,o,i);c&&n.push(c)});const l=n.some(o=>o.startsWith("v-col-"));return n.push({"v-col":!l||!e.cols,[`v-col-${e.cols}`]:e.cols,[`offset-${e.offset}`]:e.offset,[`order-${e.order}`]:e.order,[`align-self-${e.alignSelf}`]:e.alignSelf}),n});return()=>{var n;return St(e.tag,{class:s.value},(n=a.default)==null?void 0:n.call(a))}}}),Ha=["sm","md","lg","xl","xxl"],Ue=["start","end","center"];function We(e,t){return Ha.reduce((a,s)=>(a[e+$e(s)]=t(),a),{})}const Ht=e=>[...Ue,"baseline","stretch"].includes(e),Ft=We("align",()=>({type:String,default:null,validator:Ht})),Yt=e=>[...Ue,"space-between","space-around"].includes(e),jt=We("justify",()=>({type:String,default:null,validator:Yt})),Ut=e=>[...Ue,"space-between","space-around","stretch"].includes(e),Wt=We("alignContent",()=>({type:String,default:null,validator:Ut})),rt={align:Object.keys(Ft),justify:Object.keys(jt),alignContent:Object.keys(Wt)},Fa={align:"align",justify:"justify",alignContent:"align-content"};function Ya(e,t,a){let s=Fa[e];if(a!=null)return t&&(s+=`-${t.replace(e,"")}`),s+=`-${a}`,s.toLowerCase()}const qt=Z({name:"VRow",props:h(h(x(h(x(h({dense:Boolean,noGutters:Boolean,align:{type:String,default:null,validator:Ht}},Ft),{justify:{type:String,default:null,validator:Yt}}),jt),{alignContent:{type:String,default:null,validator:Ut}}),Wt),ie()),setup(e,t){let{slots:a}=t;const s=C(()=>{const n=[];let r;for(r in rt)rt[r].forEach(l=>{const o=e[l],i=Ya(r,l,o);i&&n.push(i)});return n.push({"v-row--no-gutters":e.noGutters,"v-row--dense":e.dense,[`align-${e.align}`]:e.align,[`justify-${e.justify}`]:e.justify,[`align-content-${e.alignContent}`]:e.alignContent}),n});return()=>{var n;return St(e.tag,{class:["v-row",s.value]},(n=a.default)==null?void 0:n.call(a))}}}),lt=X("flex-grow-1","div","VSpacer"),H="/arknights-assets",Ae=[{id:"MAIN_STORY",name:"Main Theme"},{id:"ACTIVITY_STORY",name:"Public Affairs"},{id:"MINI_STORY",name:"Special Operation"},{id:"CHARACTER_STORY",name:"Operator Records"}],it=[{id:"zh_CN",name:"China"},{id:"en_US",name:"Global"},{id:"ja_JP",name:"Japan"},{id:"ko_KR",name:"Korea"},{id:"zh_TW",name:"Taiwan"}],ja={emits:["SELECT_TYPE"],data(){return{storyTypeList:Ae}}};function Ua(e,t,a,s,n,r){return f(),p(ce,null,{default:g(()=>[(f(!0),S(E,null,F(n.storyTypeList,(l,o)=>(f(),p(oe,{key:o,onClick:i=>this.$emit("SELECT_TYPE",l.id)},{default:g(()=>[u(pe,null,{default:g(()=>[R($(l.name),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})}var Wa=w(ja,[["render",Ua]]);const qa={props:["items","server","type","stage"],emits:["SELECT_HOME","SELECT_TYPE","SELECT_STORY_ID"],methods:{getStoryName(e){return`${e.code?`${e.code}: `:""}${e.name[this.server]}`}}},za=R("mdi-home");function Ga(e,t,a,s,n,r){return f(),S(E,null,[u(z,{variant:"text",class:ee({"d-none":a.type==="preview","d-none d-sm-inline-flex":a.type!=="preview"}),onClick:t[0]||(t[0]=l=>this.$emit("SELECT_HOME"))},{default:g(()=>[u(Q,null,{default:g(()=>[za]),_:1})]),_:1},8,["class"]),a.items.type?(f(),p(z,{key:0,variant:"text",class:ee({"d-none d-sm-inline-flex":a.type==="preview"||a.type!=="preview"&&a.stage!=="SELECT_STORY_ID"}),onClick:t[1]||(t[1]=l=>this.$emit("SELECT_TYPE",a.items.type.id))},{default:g(()=>[R($(a.items.type.name),1)]),_:1},8,["class"])):I("",!0),a.items.episode?(f(),p(z,{key:1,variant:"text",class:ee({"d-none d-sm-inline-flex":a.type==="preview"||a.type!=="preview"&&a.stage!=="SELECT_STORY_INDEX"}),onClick:t[2]||(t[2]=l=>this.$emit("SELECT_STORY_ID",a.items.episode.id))},{default:g(()=>[R($(a.items.episode.name[a.server]),1)]),_:1},8,["class"])):I("",!0),a.items.story?(f(),p(z,{key:2,variant:"text",class:ee({"d-none d-sm-inline-flex":a.type!=="preview"})},{default:g(()=>[R($(r.getStoryName(a.items.story)),1)]),_:1},8,["class"])):I("",!0)],64)}var Xa=w(qa,[["render",Ga]]);const Ka={props:["storyByChapter","server"],emits:["SELECT_STORY_ID"],methods:{getEpisode(e){return`Episode ${e.split("_")[1]}`},getImageSrc(e){return`${H}/images/storyEntryPic/main/zone_page_${e}.png`}}};function Za(e,t,a,s,n,r){return f(!0),S(E,null,F(a.storyByChapter,(l,o)=>(f(),S(E,{key:o},[a.server in l.name?(f(),p(ce,{key:0},{default:g(()=>[u(ra,null,{default:g(()=>[R($(l.name[a.server]),1)]),_:2},1024),(f(!0),S(E,null,F(l.story,(i,c)=>(f(),p(oe,{key:c,"prepend-avatar":r.getImageSrc(i.id),onClick:d=>this.$emit("SELECT_STORY_ID",i.id)},{default:g(()=>[u(Ve,null,{default:g(()=>[u(pe,null,{default:g(()=>[R($(r.getEpisode(i.id)),1)]),_:2},1024),u(la,null,{default:g(()=>[R($(i.name[a.server]),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["prepend-avatar","onClick"]))),128))]),_:2},1024)):I("",!0)],64))),128)}var Ja=w(Ka,[["render",Za]]);const Qa={props:["storyList","server"],emits:["SELECT_STORY_ID"],methods:{getImageSrc(e){return`${H}/images/storyEntryPic/activity/${e}.png`}}};function en(e,t,a,s,n,r){return f(),p(ce,null,{default:g(()=>[(f(!0),S(E,null,F(a.storyList,(l,o)=>(f(),S(E,{key:o},[a.server in l.name?(f(),p(oe,{key:0,"prepend-avatar":r.getImageSrc(l.entryPic),onClick:i=>this.$emit("SELECT_STORY_ID",l.id)},{default:g(()=>[u(Ve,null,{default:g(()=>[u(pe,null,{default:g(()=>[R($(l.name[a.server]),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["prepend-avatar","onClick"])):I("",!0)],64))),128))]),_:1})}var tn=w(Qa,[["render",en]]);const an={props:["storyList","server"],emits:["SELECT_STORY_INDEX"],methods:{getStoryName(e){return`${e.code?`${e.code}: `:""}${e.name[this.server]}`}}};function nn(e,t,a,s,n,r){return f(),p(ce,null,{default:g(()=>[(f(!0),S(E,null,F(a.storyList,(l,o)=>(f(),S(E,{key:o},[a.server in l.name?(f(),p(oe,{key:0,onClick:i=>this.$emit("SELECT_STORY_INDEX",l.sort)},{default:g(()=>[u(Ve,null,{default:g(()=>[u(pe,null,{default:g(()=>[R($(r.getStoryName(l)),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])):I("",!0)],64))),128))]),_:1})}var sn=w(an,[["render",nn]]);const rn={props:["storyList","server"],emits:["SELECT_STORY_ID"],methods:{getImageSrc(e){return`${H}/images/avatar/${e}.png`}}};function ln(e,t,a,s,n,r){return f(),p(ce,null,{default:g(()=>[(f(!0),S(E,null,F(a.storyList,(l,o)=>(f(),S(E,{key:o},[a.server in l.name?(f(),p(oe,{key:0,"prepend-avatar":r.getImageSrc(l.character.id),onClick:i=>this.$emit("SELECT_STORY_ID",l.id),title:l.character.name[a.server],subtitle:l.name[a.server]},null,8,["prepend-avatar","onClick","title","subtitle"])):I("",!0)],64))),128))]),_:1})}var on=w(rn,[["render",ln]]);const cn=Z({name:"VCardActions",setup(e,t){let{slots:a}=t;return ia({VBtn:{variant:"text"}}),Ct(()=>{var s;return u("div",{class:"v-card-actions"},[a==null||(s=a.default)==null?void 0:s.call(a)])}),{}}}),ot=X("v-card-avatar"),un=X("v-card-content"),dn=X("v-card-header"),mn=X("v-card-header-text"),fn=X("v-card-img"),vn=X("v-card-subtitle"),qe=X("v-card-text"),gn=X("v-card-title"),ze=Z({name:"VCard",directives:{Ripple:oa},props:h(h(h(h(h(h(h(h(h(h({appendAvatar:String,appendIcon:String,disabled:Boolean,flat:Boolean,hover:Boolean,image:String,link:Boolean,prependAvatar:String,prependIcon:String,ripple:Boolean,subtitle:String,text:String,title:String},_e()),Et()),ca()),Se()),Tt()),bt()),Ne()),ua()),ie()),da({variant:"contained"})),setup(e,t){let{attrs:a,slots:s}=t;const{themeClasses:n}=Ce(e),{borderClasses:r}=xt(e),{colorClasses:l,colorStyles:o,variantClasses:i}=ma(e),{densityClasses:c}=fa(e),{dimensionStyles:d}=Ee(e),{elevationClasses:v}=kt(e),{positionClasses:m,positionStyles:_}=It(e),{roundedClasses:y}=Me(e),O=va(e,a);return()=>{var b,P,L,A;const B=O.isLink.value?"a":e.tag,U=!!(s.title||e.title),N=!!(s.subtitle||e.subtitle),M=U||N,K=!!(s.append||e.appendAvatar||e.appendIcon),Y=!!(s.prepend||e.prependAvatar||e.prependIcon),G=!!(s.image||e.image),T=M||Y||K,q=!!(s.text||e.text),J=!e.disabled&&(O.isClickable.value||e.link);return ge(u(B,{class:["v-card",{"v-card--disabled":e.disabled,"v-card--flat":e.flat,"v-card--hover":e.hover&&!(e.disabled||e.flat),"v-card--link":J},n.value,r.value,l.value,c.value,v.value,m.value,y.value,i.value],style:[o.value,d.value,_.value],href:O.href.value,onClick:J&&O.navigate},{default:()=>[ga(J,"v-card"),G&&u(xe,{defaults:{VImg:{cover:!0,src:e.image}}},{default:()=>[u(fn,null,{default:()=>[s.image?(b=s.image)==null?void 0:b.call(s):u(He,{alt:""},null)]})]}),(P=s.media)==null?void 0:P.call(s),T&&u(dn,null,{default:()=>[Y&&u(xe,{defaults:{VAvatar:{density:e.density,icon:e.prependIcon,image:e.prependAvatar}}},{default:()=>[u(ot,null,{default:()=>[s.prepend?s.prepend():u(tt,null,null)]})]}),M&&u(mn,null,{default:()=>[U&&u(gn,null,{default:()=>[s.title?s.title():e.title]}),N&&u(vn,null,{default:()=>[s.subtitle?s.subtitle():e.subtitle]}),(L=s.headerText)==null?void 0:L.call(s)]}),K&&u(xe,{defaults:{VAvatar:{density:e.density,icon:e.appendIcon,image:e.appendAvatar}}},{default:()=>[u(ot,null,{default:()=>[s.append?s.append():u(tt,null,null)]})]})]}),q&&u(qe,null,{default:()=>[s.text?s.text():e.text]}),s.content&&u(un,null,{default:s.content}),(A=s.default)==null?void 0:A.call(s),s.actions&&u(cn,null,{default:s.actions})]}),[[Rt("ripple"),J]])}}});const yn=ue({closeDelay:[Number,String],openDelay:[Number,String]},"delay");function hn(e,t){const a={},s=n=>()=>{if(!W)return Promise.resolve(!0);const r=n==="openDelay";return a.closeDelay&&window.clearTimeout(a.closeDelay),delete a.closeDelay,a.openDelay&&window.clearTimeout(a.openDelay),delete a.openDelay,new Promise(l=>{var o;const i=parseInt((o=e[n])!=null?o:0,10);a[n]=window.setTimeout(()=>{t==null||t(r),l(r)},i)})};return{runCloseDelay:s("closeDelay"),runOpenDelay:s("openDelay")}}const pn=ue(h({activator:[String,Object],activatorProps:{type:Object,default:()=>({})},openOnClick:{type:Boolean,default:void 0},openOnHover:Boolean,openOnFocus:{type:Boolean,default:void 0}},yn()));function _n(e,t){const a=V();let s=!1,n=!1;const r=C(()=>e.openOnFocus||e.openOnFocus==null&&e.openOnHover),l=C(()=>e.openOnClick||e.openOnClick==null&&!e.openOnHover&&!r.value),{runOpenDelay:o,runCloseDelay:i}=hn(e,y=>{y===(e.openOnHover&&s||r.value&&n)&&(t.value=y)}),c={click:y=>{y.stopPropagation(),a.value=y.currentTarget||y.target,t.value=!t.value},mouseenter:y=>{s=!0,a.value=y.currentTarget||y.target,o()},mouseleave:y=>{s=!1,i()},focus:y=>{ha&&!y.target.matches(":focus-visible")||(n=!0,y.stopPropagation(),a.value=y.currentTarget||y.target,o())},blur:y=>{n=!1,y.stopPropagation(),i()}},d=C(()=>{const y={};return l.value&&(y.click=c.click),e.openOnHover&&(y.mouseenter=c.mouseenter,y.mouseleave=c.mouseleave),r.value&&(y.focus=c.focus,y.blur=c.blur),y}),v=V();Te(()=>{!v.value||ae(()=>{const y=v.value;a.value=ya(y)?y.$el:y})});const m=wt("useActivator");let _;return j(()=>!!e.activator,y=>{y&&W?(_=be(),_.run(()=>{Sn(e,m,{activatorEl:a,activatorRef:v,activatorEvents:d})})):_&&_.stop()},{flush:"post",immediate:!0}),{activatorEl:a,activatorRef:v,activatorEvents:d}}function Sn(e,t,a){let{activatorEl:s,activatorEvents:n}=a;j(()=>e.activator,(i,c)=>{if(c&&i!==c){const d=o(c);d&&l(d)}i&&ae(()=>r())},{immediate:!0}),j(()=>e.activatorProps,()=>{r()}),ne(()=>{l()});function r(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:o(),c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:e.activatorProps;!i||(Object.entries(n.value).forEach(d=>{let[v,m]=d;i.addEventListener(v,m)}),Object.keys(c).forEach(d=>{c[d]==null?i.removeAttribute(d):i.setAttribute(d,c[d])}))}function l(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:o(),c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:e.activatorProps;!i||(Object.entries(n.value).forEach(d=>{let[v,m]=d;i.removeEventListener(v,m)}),Object.keys(c).forEach(d=>{i.removeAttribute(d)}))}function o(){var i;let c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:e.activator,d;if(c)if(c==="parent"){var v,m;d=t==null||(v=t.proxy)==null||(m=v.$el)==null?void 0:m.parentNode}else typeof c=="string"?d=document.querySelector(c):"$el"in c?d=c.$el:d=c;return s.value=((i=d)==null?void 0:i.nodeType)===Node.ELEMENT_NODE?d:null,s.value}}function ct(e){let[t,a]=e.split(" ");return a||(a=t==="top"||t==="bottom"?"start":t==="start"||t==="end"?"top":"center"),{side:t,align:a}}function Ie(e){return{side:{center:"center",top:"bottom",bottom:"top",start:"end",end:"start"}[e.side],align:e.align}}function ut(e,t){var a,s;const{side:n,align:r}=e,{direction:l}=window.getComputedStyle(t),o=l==="ltr"?{start:"left",end:"right"}:{start:"right",end:"left"};return((a=o[n])!=null?a:n)+" "+((s=o[r])!=null?s:r)}function Re(e,t){return{x:e.x+t.x,y:e.y+t.y}}function Cn(e,t){return{x:e.x-t.x,y:e.y-t.y}}function dt(e,t){if(e.side==="top"||e.side==="bottom"){const{side:a,align:s}=e,n=s==="start"?0:s==="center"?t.width/2:s==="end"?t.width:s,r=a==="top"?0:a==="bottom"?t.height:a;return Re({x:n,y:r},t)}else if(e.side==="start"||e.side==="end"){const{side:a,align:s}=e,n=a==="start"?0:a==="end"?t.width:a,r=s==="top"?0:s==="center"?t.height/2:s==="bottom"?t.height:s;return Re({x:n,y:r},t)}return Re({x:t.width/2,y:t.height/2},t)}const zt={static:bn,connected:xn},En=ue({positionStrategy:{type:[String,Function],default:"static",validator:e=>typeof e=="function"||e in zt},anchor:{type:String,default:"bottom"},origin:{type:String,default:"auto"},offset:[Number,String]});function Tn(e,t){const a=V({}),s=V();let n;Te(async()=>{var l;(l=n)==null||l.stop(),s.value=void 0,W&&t.isActive.value&&e.positionStrategy&&(n=be(),await ae(),n.run(()=>{if(typeof e.positionStrategy=="function"){var o;s.value=(o=e.positionStrategy(t,e,a))==null?void 0:o.updatePosition}else{var i;s.value=(i=zt[e.positionStrategy](t,e,a))==null?void 0:i.updatePosition}}))}),W&&window.addEventListener("resize",r,{passive:!0}),ne(()=>{var l;W&&window.removeEventListener("resize",r),s.value=void 0,(l=n)==null||l.stop()});function r(l){var o;(o=s.value)==null||o.call(s,l)}return{contentStyles:a,updatePosition:s}}function bn(){}function xn(e,t,a){const s=Va(e.activatorEl.value);s&&Object.assign(a.value,{position:"fixed"});const n=C(()=>ct(t.anchor)),r=C(()=>t.origin==="overlap"?n.value:t.origin==="auto"?Ie(n.value):ct(t.origin)),l=C(()=>n.value.side===r.value.side),o=C(()=>{const v=parseFloat(t.maxHeight);return isNaN(v)?1/0:v}),i=C(()=>{const v=parseFloat(t.minWidth);return isNaN(v)?1/0:v});let c=!1;if(W){const v=new ResizeObserver(()=>{c&&d()});v.observe(e.activatorEl.value),v.observe(e.contentEl.value),ne(()=>{v.disconnect()})}function d(){var v;c=!1,requestAnimationFrame(()=>{requestAnimationFrame(()=>c=!0)});const m=e.activatorEl.value.getBoundingClientRect();t.offset&&(m.x-=+t.offset,m.y-=+t.offset,m.width+=+t.offset*2,m.height+=+t.offset*2);const _=$t(e.contentEl.value),y=_.clientWidth,O=Math.min(_.clientHeight,window.innerHeight);let b;{const Xe=new Map;e.contentEl.value.querySelectorAll("*").forEach(se=>{const de=se.scrollLeft,Ke=se.scrollTop;(de||Ke)&&Xe.set(se,[de,Ke])});const ea=e.contentEl.value.style.maxWidth,ta=e.contentEl.value.style.maxHeight;e.contentEl.value.style.removeProperty("max-width"),e.contentEl.value.style.removeProperty("max-height"),b=Pt(e.contentEl.value),b.x-=parseFloat(e.contentEl.value.style.left)||0,b.y-=parseFloat(e.contentEl.value.style.top)||0,e.contentEl.value.style.maxWidth=ea,e.contentEl.value.style.maxHeight=ta,Xe.forEach((se,de)=>{de.scrollTo(...se)})}const P=Math.min(o.value,b.height),L=t.maxWidth===void 0?Number.MAX_VALUE:parseInt((v=t.maxWidth)!=null?v:0,10),A=12,B={top:m.top-A,bottom:O-m.bottom-A,left:Math.min(m.left-A,L),right:Math.min(y-m.right-A,L)},U=n.value.side==="bottom"&&P<=B.bottom||n.value.side==="top"&&P<=B.top,N=U?n.value:n.value.side==="bottom"&&B.top>B.bottom||n.value.side==="top"&&B.bottom>B.top?Ie(n.value):n.value,M=U?r.value:Ie(N),Y=l.value||["center","top","bottom"].includes(N.side)?Math.min(y,Math.max(m.width,y-A*2)):N.side==="end"?B.right:N.side==="start"?B.left:null,G=Math.min(i.value,Y,m.width),T=U?o.value:Math.min(o.value,Math.floor(N.side==="top"?B.top:B.bottom)),q=dt(N,m),J=dt(M,new fe(x(h({},b),{height:Math.min(P,T)}))),{x:Jt,y:Qt}=Cn(q,J);Object.assign(a.value,{"--v-overlay-anchor-origin":ut(N,e.activatorEl.value),top:k(Math.round(Qt)),left:k(Math.round(Jt)),transformOrigin:ut(M,e.activatorEl.value),minWidth:k(G),maxWidth:k(Y),maxHeight:k(T)})}return j(()=>[n.value,r.value,t.offset],()=>d(),{immediate:!s}),s&&ae(()=>d()),requestAnimationFrame(()=>{a.value.maxHeight&&d()}),{updatePosition:d}}let De=!0;const he=[];function kn(e){!De||he.length?(he.push(e),Pe()):(De=!1,e(),Pe())}let mt=-1;function Pe(){cancelAnimationFrame(mt),mt=requestAnimationFrame(()=>{const e=he.shift();e&&e(),he.length?Pe():De=!0})}const Be={none:null,close:wn,block:On,reposition:Ln},In=ue({scrollStrategy:{type:[String,Function],default:"block",validator:e=>typeof e=="function"||e in Be}});function Rn(e,t){if(!W)return;let a;Te(async()=>{var s;(s=a)==null||s.stop(),t.isActive.value&&e.scrollStrategy&&(a=be(),await ae(),a.run(()=>{if(typeof e.scrollStrategy=="function")e.scrollStrategy(t);else{var n;(n=Be[e.scrollStrategy])==null||n.call(Be,t)}}))})}function wn(e){var t;function a(s){e.isActive.value=!1}Gt((t=e.activatorEl.value)!=null?t:e.contentEl.value,a)}function On(e){var t;const a=[...new Set([...Oe(e.activatorEl.value),...Oe(e.contentEl.value)])].filter(r=>!r.classList.contains("v-overlay-scroll-blocked")),s=window.innerWidth-document.documentElement.offsetWidth,n=(r=>Ye(r)&&r)(((t=e.root.value)==null?void 0:t.offsetParent)||document.documentElement);n&&e.root.value.classList.add("v-overlay--scroll-blocked"),a.forEach((r,l)=>{r===document.documentElement&&/iphone|ipad|ipod/i.test(navigator.userAgent)&&(r.style.setProperty("--v-ios-body-scroll-x",k(-r.scrollLeft)),r.style.setProperty("--v-ios-body-scroll-y",k(-r.scrollTop))),r.style.setProperty("--v-scrollbar-offset",k(s)),r.classList.add("v-overlay-scroll-blocked")}),ne(()=>{a.forEach((r,l)=>{r.style.removeProperty("--v-ios-body-scroll-x"),r.style.removeProperty("--v-ios-body-scroll-y"),r.style.removeProperty("--v-scrollbar-offset"),r.classList.remove("v-overlay-scroll-blocked")}),n&&e.root.value.classList.remove("v-overlay--scroll-blocked")})}function Ln(e){var t;let a=!1,s=-1;function n(r){kn(()=>{var l,o;const i=performance.now();(l=(o=e.updatePosition).value)==null||l.call(o,r),a=(performance.now()-i)/(1e3/60)>2})}Gt((t=e.activatorEl.value)!=null?t:e.contentEl.value,r=>{a?(cancelAnimationFrame(s),s=requestAnimationFrame(()=>{s=requestAnimationFrame(()=>{n(r)})})):n(r)})}function Gt(e,t){const a=[document,...Oe(e)];a.forEach(s=>{s.addEventListener("scroll",t,{passive:!0})}),ne(()=>{a.forEach(s=>{s.removeEventListener("scroll",t)})})}function le(e){return{teleportTarget:C(()=>{const a=e.value;if(a===!0||!W)return;const s=a===!1?document.body:typeof a=="string"?document.querySelector(a):a;if(s==null){pa(`Unable to locate target ${a}`);return}if(!le.cache.has(s)){const n=document.createElement("div");n.className="v-overlay-container",s.appendChild(n),le.cache.set(s,n)}return le.cache.get(s)})}}le.cache=new WeakMap;const An=ue({eager:Boolean},"lazy");function Dn(e,t){const a=V(!1),s=C(()=>a.value||e.eager||t.value);j(t,()=>a.value=!0);function n(){e.eager||(a.value=!1)}return{isBooted:a,hasContent:s,onAfterLeave:n}}const re=V([]);function Pn(e){const t=wt("useStack");let a;j(e,n=>{if(n)a=be(),a.run(()=>{re.value.push(t),ne(()=>{const l=re.value.indexOf(t);re.value.splice(l,1)})});else{var r;(r=a)==null||r.stop()}},{immediate:!0});const s=V(!0);return Te(()=>{const n=Sa(re.value[re.value.length-1])===t;setTimeout(()=>s.value=n)}),{isTop:_a(s)}}const ft=Symbol.for("vuetify:overlay"),Bn=2e3;function $n(e){const{zIndex:t,overlays:a}=Ca(ft,{zIndex:V(Bn),overlays:V([])}),s=Ea();return j(e,r=>{r?a.value.push(s):a.value=a.value.filter(l=>l!==s)},{immediate:!0}),Ta(ft,{zIndex:t,overlays:a}),{overlayZIndex:C(()=>t.value+a.value.indexOf(s)+1)}}function Vn(){return!0}function Xt(e,t,a){if(!e||Kt(e,a)===!1)return!1;const s=Bt(t);if(typeof ShadowRoot!="undefined"&&s instanceof ShadowRoot&&s.host===e.target)return!1;const n=(typeof a.value=="object"&&a.value.include||(()=>[]))();return n.push(t),!n.some(r=>r==null?void 0:r.contains(e.target))}function Kt(e,t){return(typeof t.value=="object"&&t.value.closeConditional||Vn)(e)}function Nn(e,t,a){const s=typeof a.value=="function"?a.value:a.value.handler;t._clickOutside.lastMousedownWasOutside&&Xt(e,t,a)&&setTimeout(()=>{Kt(e,a)&&s&&s(e)},0)}function vt(e,t){const a=Bt(e);t(document),typeof ShadowRoot!="undefined"&&a instanceof ShadowRoot&&t(a)}const Mn={mounted(e,t){const a=n=>Nn(n,e,t),s=n=>{e._clickOutside.lastMousedownWasOutside=Xt(n,e,t)};vt(e,n=>{n.addEventListener("click",a,!0),n.addEventListener("mousedown",s,!0)}),e._clickOutside||(e._clickOutside={lastMousedownWasOutside:!0}),e._clickOutside[t.instance.$.uid]={onClick:a,onMousedown:s}},unmounted(e,t){!e._clickOutside||(vt(e,a=>{var s;if(!a||!((s=e._clickOutside)!=null&&s[t.instance.$.uid]))return;const{onClick:n,onMousedown:r}=e._clickOutside[t.instance.$.uid];a.removeEventListener("click",n,!0),a.removeEventListener("mousedown",r,!0)}),delete e._clickOutside[t.instance.$.uid])}};function Hn(e){const n=e,{modelValue:t,color:a}=n,s=et(n,["modelValue","color"]);return u(ve,{name:"fade-transition",appear:!0},{default:()=>[e.modelValue&&u("div",te({class:["v-overlay__scrim",e.color.backgroundColorClasses.value],style:e.color.backgroundColorStyles.value},s),null)]})}const Fn=Ot()({name:"VOverlay",directives:{ClickOutside:Mn},inheritAttrs:!1,props:h(h(h(h(h(h(h({absolute:Boolean,attach:[Boolean,String,Object],contained:Boolean,contentClass:null,noClickAnimation:Boolean,modelValue:Boolean,persistent:Boolean,scrim:{type:[String,Boolean],default:!0}},pn()),Se()),En()),In()),_e()),Lt()),An()),emits:{"click:outside":e=>!0,"update:modelValue":e=>!0,afterLeave:()=>!0},setup(e,t){let{slots:a,attrs:s,emit:n}=t;const r=Fe(e,"modelValue"),{teleportTarget:l}=le(C(()=>e.attach||e.contained)),{themeClasses:o}=Ce(e),{rtlClasses:i}=At(),{hasContent:c,onAfterLeave:d}=Dn(e,r),v=ye(C(()=>typeof e.scrim=="string"?e.scrim:null)),{activatorEl:m,activatorRef:_,activatorEvents:y}=_n(e,r),{dimensionStyles:O}=Ee(e),{isTop:b}=Pn(r),P=V(),L=V(),{contentStyles:A,updatePosition:B}=Tn(e,{contentEl:L,activatorEl:m,isActive:r});Rn(e,{root:P,contentEl:L,activatorEl:m,isActive:r,updatePosition:B});function U(T){n("click:outside",T),e.persistent?Y():r.value=!1}function N(){return r.value&&b.value}W&&j(r,T=>{T?window.addEventListener("keydown",M):window.removeEventListener("keydown",M)},{immediate:!0});function M(T){T.key==="Escape"&&b.value&&(e.persistent?Y():r.value=!1)}ba(T=>{b.value&&r.value?(T(!1),e.persistent?Y():r.value=!1):T()});const K=V();j(()=>r.value&&(e.absolute||e.contained)&&l.value==null,T=>{if(T){const q=$t(P.value);q&&q!==document.scrollingElement&&(K.value=q.scrollTop)}});function Y(){var T;e.noClickAnimation||(T=L.value)==null||T.animate([{transformOrigin:"center"},{transform:"scale(1.03)"},{transformOrigin:"center"}],{duration:150,easing:Pa})}const{overlayZIndex:G}=$n(r);return Ct(()=>{var T,q;return u(E,null,[(T=a.activator)==null?void 0:T.call(a,{isActive:r.value,props:te({ref:_},xa(y.value),e.activatorProps)}),W&&u(ka,{disabled:!l.value,to:l.value},{default:()=>[c.value&&u("div",te({class:["v-overlay",{"v-overlay--absolute":e.absolute||e.contained,"v-overlay--active":r.value,"v-overlay--contained":e.contained},o.value,i.value],style:{top:k(K.value),zIndex:G.value},ref:P},s),[u(Hn,{color:v,modelValue:r.value&&!!e.scrim},null),u(Ia,{appear:!0,persisted:!0,transition:e.transition,target:m.value,onAfterLeave:()=>{d(),n("afterLeave")}},{default:()=>[ge(u("div",{ref:L,class:["v-overlay__content",e.contentClass],style:[O.value,A.value]},[(q=a.default)==null?void 0:q.call(a,{isActive:r})]),[[Ra,r.value],[Rt("click-outside"),{handler:U,closeConditional:N,include:()=>[m.value]}]])]})])]})])}),{animateClick:Y,contentEl:L,activatorEl:m}}}),Zt=Ot()({name:"VDialog",inheritAttrs:!1,props:h(h({fullscreen:Boolean,origin:{type:String,default:"center center"},retainFocus:{type:Boolean,default:!0},scrollable:Boolean,modelValue:Boolean},Se({width:"auto"})),Lt({transition:{component:Na}})),emits:{"update:modelValue":e=>!0},setup(e,t){let{attrs:a,slots:s}=t;const n=Fe(e,"modelValue"),{dimensionStyles:r}=Ee(e),l=V();function o(i){var c;const d=i.relatedTarget,v=i.target;if(d!==v&&(c=l.value)!=null&&c.contentEl&&![document,l.value.contentEl].includes(v)&&!l.value.contentEl.contains(v)){const m=[...l.value.contentEl.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])')].filter(O=>!O.hasAttribute("disabled"));if(!m.length)return;const _=m[0],y=m[m.length-1];d===_?y.focus():_.focus()}}return W&&j(()=>n.value&&e.retainFocus,i=>{i?document.addEventListener("focusin",o):document.removeEventListener("focusin",o)},{immediate:!0}),j(n,async i=>{if(await ae(),i){var c;(c=l.value.contentEl)==null||c.focus({preventScroll:!0})}else{var d;(d=l.value.activatorEl)==null||d.focus({preventScroll:!0})}}),()=>u(Fn,te({modelValue:n.value,"onUpdate:modelValue":i=>n.value=i,class:["v-dialog",{"v-dialog--fullscreen":e.fullscreen,"v-dialog--scrollable":e.scrollable}],style:r.value,transition:e.transition,ref:l,"aria-role":"dialog","aria-modal":"true",activatorProps:{"aria-haspopup":"dialog","aria-expanded":String(n.value)}},a),{default:s.default,activator:s.activator})}});const Yn=Z({name:"VFooter",props:h(h(h(h(h(h(h({color:String},Et()),Se()),Tt()),bt()),Ne()),ie({tag:"footer"})),_e()),setup(e,t){let{slots:a}=t;const{themeClasses:s}=Ce(e),{backgroundColorClasses:n,backgroundColorStyles:r}=ye(wa(e,"color")),{borderClasses:l}=xt(e),{dimensionStyles:o}=Ee(e),{elevationClasses:i}=kt(e),{positionClasses:c,positionStyles:d}=It(e),{roundedClasses:v}=Me(e);return()=>u(e.tag,{class:["v-footer",s.value,n.value,l.value,i.value,c.value,v.value],style:[r,o.value,d.value]},a)}}),jn={props:["storyTable"],emits:["selectFile"],data(){return{dialog:!1,ready:!1,stage:"SELECT_TYPE",story:{type:"",id:"",index:1},server:"en_US",serverList:it}},created(){this.$watch(()=>[this.$route.query.storyType,this.$route.query.storyId,this.$route.query.storyIndex,this.$route.query.server],()=>{this.getUrlQuery()},{immediate:!0})},computed:{stageComponent(){let e="TYPE";return this.stage==="SELECT_STORY_ID"&&this.story.type==="MAIN_STORY"&&(e="MAIN"),this.stage==="SELECT_STORY_ID"&&["ACTIVITY_STORY","MINI_STORY"].includes(this.story.type)&&(e="ACTIVITY"),this.stage==="SELECT_STORY_ID"&&this.story.type==="CHARACTER_STORY"&&(e="CHARACTER"),this.stage==="SELECT_STORY_INDEX"&&(e="INDEX"),e}},methods:{getUrlQuery(){let e=this.$route.query,t=!1,a="en_US",s;if(e.server&&it.find(n=>n.id===e.server)&&(this.server=e.server),a=e.server,e.storyType&&Ae.find(n=>n.id===e.storyType)){let n=e.storyType;if(this.story.type=n,e.storyId&&e.storyId in this.storyTable.story[n]){let r=e.storyId,l=this.storyTable.story[n][r];if(a in l.name){this.story.id=r;let o;e.storyIndex&&(o=l.story.find(i=>i.sort===parseInt(e.storyIndex)))&&(this.story.index=o.sort,s=o.file,t=!0)}}}t?this.$emit("selectFile",{file:s,server:this.server}):this.dialog=!0},getMainStoryByChapter(){let e=Object.entries(this.storyTable.story.MAIN_STORY).reduce((t,[a,s])=>{if(!(s.chapter in t)){let n=this.storyTable.data.chapter[s.chapter];t[s.chapter]={id:s.chapter,name:n.name,story:[]}}return t[s.chapter].story.push(x(h({},s),{id:a})),t},{});return Object.values(e)},getActivityStoryList(){return Object.entries(this.storyTable.story[this.story.type]).map(([e,t])=>x(h({},t),{id:e}))},getCharacterStoryList(){return Object.entries(this.storyTable.story.CHARACTER_STORY).map(([e,t])=>{let a=this.storyTable.data.character[t.character];return x(h({},t),{id:e,character:{id:t.character,name:a.name}})})},getStoryList(){return this.storyTable.story[this.story.type][this.story.id].story},getBreadcrumbItems(){let e,t,a;return e=Ae.find(s=>s.id===this.story.type),e&&(t=this.storyTable.story[this.story.type][this.story.id]),t&&(a=t.story.find(s=>s.sort===this.story.index)),{type:e,episode:t?x(h({},t),{id:this.story.id}):void 0,story:a?x(h({},a),{index:this.story.index}):void 0}},selectHome(){this.ready=!1,this.stage="SELECT_TYPE",this.story={}},selectType(e){this.ready=!1,this.stage="SELECT_STORY_ID",this.story={type:e}},selectStoryId(e){this.ready=!1,this.stage="SELECT_STORY_INDEX",this.story={type:this.story.type,id:e}},selectStoryIndex(e){this.story={type:this.story.type,id:this.story.id,index:e},this.ready=!0},select(){this.dialog=!1,this.$router.push({path:"/story-reader",query:{storyType:this.story.type,storyId:this.story.id,storyIndex:this.story.index,server:this.server}})},goBack(){this.ready=!1,this.stage==="SELECT_STORY_INDEX"?this.stage="SELECT_STORY_ID":this.stage="SELECT_TYPE"}},components:{StorySelectorType:Wa,StorySelectorBreadcrumb:Xa,StorySelectorMain:Ja,StorySelectorActivity:tn,StorySelectorIndex:sn,StorySelectorCharacter:on}},Un=R("mdi-close"),Wn=R("mdi-earth"),qn=["value"],zn=R("Select"),Gn=R("mdi-close"),Xn=R("mdi-earth"),Kn=["value"],Zn=R("mdi-chevron-left"),Jn=R("Select");function Qn(e,t,a,s,n,r){const l=D("StorySelectorBreadcrumb"),o=D("StorySelectorType"),i=D("StorySelectorMain"),c=D("StorySelectorActivity"),d=D("StorySelectorCharacter"),v=D("StorySelectorIndex");return f(),p(Zt,{modelValue:n.dialog,"onUpdate:modelValue":t[7]||(t[7]=m=>n.dialog=m),scrim:!1,transition:"dialog-bottom-transition",fullscreen:"",scrollable:"",class:"dialog"},{activator:g(({props:m})=>[u(Oa,te({density:"compact"},m),{default:g(()=>[u(l,{items:r.getBreadcrumbItems(),server:n.server,type:"preview"},null,8,["items","server"])]),_:2},1040)]),default:g(()=>[u(ze,null,{default:g(()=>[u(ke,{density:"compact",class:"d-none d-sm-flex"},{default:g(()=>[u(z,{icon:"",dark:"",onClick:t[0]||(t[0]=m=>n.dialog=!1)},{default:g(()=>[u(Q,null,{default:g(()=>[Un]),_:1})]),_:1}),u(l,{items:r.getBreadcrumbItems(),server:n.server,stage:n.stage,onSELECT_HOME:r.selectHome,onSELECT_TYPE:r.selectType},null,8,["items","server","stage","onSELECT_HOME","onSELECT_TYPE"]),u(lt),u(Q,null,{default:g(()=>[Wn]),_:1}),ge(we("select",{"onUpdate:modelValue":t[1]||(t[1]=m=>n.server=m)},[(f(!0),S(E,null,F(n.serverList,(m,_)=>(f(),S("option",{key:_,value:m.id},$(m.name),9,qn))),128))],512),[[at,n.server]]),u(z,{disabled:!n.ready,variant:"outlined",text:"",onClick:t[2]||(t[2]=m=>r.select())},{default:g(()=>[zn]),_:1},8,["disabled"])]),_:1}),u(ke,{density:"compact",class:"d-flex d-sm-none"},{default:g(()=>[u(z,{icon:"",dark:"",onClick:t[3]||(t[3]=m=>n.dialog=!1)},{default:g(()=>[u(Q,null,{default:g(()=>[Gn]),_:1})]),_:1}),u(l,{items:r.getBreadcrumbItems(),server:n.server,stage:n.stage,onSELECT_HOME:r.selectHome,onSELECT_TYPE:r.selectType},null,8,["items","server","stage","onSELECT_HOME","onSELECT_TYPE"])]),_:1}),u(ke,{density:"compact",class:"d-flex d-sm-none"},{default:g(()=>[u(Q,null,{default:g(()=>[Xn]),_:1}),ge(we("select",{"onUpdate:modelValue":t[4]||(t[4]=m=>n.server=m)},[(f(!0),S(E,null,F(n.serverList,(m,_)=>(f(),S("option",{key:_,value:m.id},$(m.name),9,Kn))),128))],512),[[at,n.server]])]),_:1}),u(Dt,{class:"dialog-container overflow-auto my-3"},{default:g(()=>[r.stageComponent==="TYPE"?(f(),p(o,{key:0,onSELECT_TYPE:r.selectType},null,8,["onSELECT_TYPE"])):I("",!0),r.stageComponent==="MAIN"?(f(),p(i,{key:1,storyByChapter:r.getMainStoryByChapter(),server:n.server,onSELECT_STORY_ID:r.selectStoryId},null,8,["storyByChapter","server","onSELECT_STORY_ID"])):I("",!0),r.stageComponent==="ACTIVITY"?(f(),p(c,{key:2,storyList:r.getActivityStoryList(),server:n.server,onSELECT_STORY_ID:r.selectStoryId},null,8,["storyList","server","onSELECT_STORY_ID"])):I("",!0),r.stageComponent==="CHARACTER"?(f(),p(d,{key:3,storyList:r.getCharacterStoryList(),server:n.server,onSELECT_STORY_ID:r.selectStoryId},null,8,["storyList","server","onSELECT_STORY_ID"])):I("",!0),r.stageComponent==="INDEX"?(f(),p(v,{key:4,storyList:r.getStoryList(),server:n.server,onSELECT_STORY_INDEX:r.selectStoryIndex},null,8,["storyList","server","onSELECT_STORY_INDEX"])):I("",!0)]),_:1}),u(Yn,{bottom:"",fixed:"",border:"",height:"48px",class:"footer d-flex d-sm-none",width:"100%"},{default:g(()=>[u(z,{variant:"text",onClick:t[5]||(t[5]=m=>r.goBack())},{default:g(()=>[u(Q,null,{default:g(()=>[Zn]),_:1})]),_:1}),u(lt),u(z,{disabled:!n.ready,variant:"outlined",text:"",onClick:t[6]||(t[6]=m=>r.select())},{default:g(()=>[Jn]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"])}var es=w(jn,[["render",Qn]]);const gt=/\[(?<tag>.+?)\((?<params>.*)\)\]\s*(?<other>.*)/g,yt=/\[(?<tag>.*)=(?<value>.*)\]/g,ht=/\[(?<tag>.*)\]/,pt=/(?<name>\w*?)\s*=\s*(?<value>".*?"|[^",)\]\s]*)/g,_t=/\[[Nn][Aa][Mm][Ee]="(?<name>.*)"(?<params>.*)\]\s*(?<text>.*)/g,ts=e=>{let t={lines:[],tagCount:{},otherLines:[]},a=e.split(`
`),s=n=>{n in t.tagCount||(t.tagCount[n]=0),t.tagCount[n]+=1};for(const n of a)if(n.match(gt)){let{tag:r,params:l,other:o}=gt.exec(n).groups;r=r.toUpperCase();let i={},c;for(;(c=pt.exec(l))!==null;){let{name:d,value:v}=c.groups;i[d]=v.replace(/"/g,"")}o&&(i.other=o),t.lines.push({tag:r,params:i}),s(r)}else if(n.match(_t)){let{name:r,params:l,text:o}=_t.exec(n).groups,i={},c;for(;(c=pt.exec(l))!==null;){let{name:d,value:v}=c.groups;i[d]=v.replace(/"/g,"")}t.lines.push({tag:"CHARACTER_SPEECH",params:x(h({},i),{name:r,text:o})}),s("CHARACTER_SPEECH")}else if(n.match(yt)){let{tag:r,value:l}=yt.exec(n).groups;r=r.toUpperCase(),t.lines.push({tag:r,params:{[r]:l}}),s(r)}else if(n.match(ht)){let{tag:r}=ht.exec(n).groups;r=r.toUpperCase(),t.lines.push({tag:r,params:{}}),s(r)}else if(n.length>0&&n.indexOf("//"!==0)){let r="DESCRIPTION";t.lines.push({tag:r,params:{text:n}}),s(r)}else t.otherLines.push(n);return t},as={props:["line"]};function ns(e,t,a,s,n,r){return f(),p(ze,{class:"my-3"},{default:g(()=>[u(qe,{style:{"font-size":"1rem","line-height":"1.5rem"}},{default:g(()=>[(f(!0),S(E,null,F(a.line.params.text,(l,o)=>(f(),S("p",{key:o},$(l),1))),128))]),_:1})]),_:1})}var ss=w(as,[["render",ns]]);const rs={props:["line"],emits:["selectCharImage"]};function ls(e,t,a,s,n,r){return f(),p(qt,{class:"my-3"},{default:g(()=>[u(Le,{cols:"12",sm:"2",class:"pb-0 pb-sm-3"},{default:g(()=>[we("p",{class:ee(["font-weight-bold text-grey",[{hasImage:a.line.params.image}]]),onClick:t[0]||(t[0]=l=>e.$emit("selectCharImage",a.line.params.image))},$(a.line.params.name),3)]),_:1}),u(Le,{cols:"12",sm:"8",class:"pt-0 pt-sm-3"},{default:g(()=>[(f(!0),S(E,null,F(a.line.params.text,(l,o)=>(f(),S("p",{key:o,class:ee({"mt-1":o>0})},$(l),3))),128))]),_:1})]),_:1})}var is=w(rs,[["render",ls]]);const os={props:["line","decision"],emits:["selectDecision"],methods:{getVariant(e){let t="contained";return(this.decision[this.line.params.id]||this.line.params.options[0].value)===e&&(t="outlined"),t},selectDecision(e){this.$emit("selectDecision",{id:this.line.params.id,value:e})}}};function cs(e,t,a,s,n,r){return f(),p(qt,{dense:"",class:"my-3"},{default:g(()=>[(f(!0),S(E,null,F(a.line.params.options,(l,o)=>(f(),p(Le,{cols:"12",key:o},{default:g(()=>[u(z,{class:"float-right text-right",variant:r.getVariant(l.value),onClick:i=>r.selectDecision(l.value)},{default:g(()=>[R($(l.text),1)]),_:2},1032,["variant","onClick"])]),_:2},1024))),128))]),_:1})}var us=w(os,[["render",cs]]);const ds={props:["line"],computed:{imageSrc(){let e="";return this.line.tag==="IMAGE"&&(e=`${H}/images/avg/imgs/${this.line.params.image}.png`),this.line.tag==="BACKGROUND"&&(e=`${H}/images/avg/bg/${this.line.params.image}.png`),this.line.params.image||(e=e=`${H}/images/avg/bg/bg_black.png`),e}}};function ms(e,t,a,s,n,r){return f(),p(He,{src:r.imageSrc,class:"my-3"},null,8,["src"])}var fs=w(ds,[["render",ms]]);const vs={props:["line"]};function gs(e,t,a,s,n,r){return f(),p(ze,{class:"my-3"},{default:g(()=>[u(qe,{class:"text-center",style:{"font-size":"1rem","line-height":"1.5rem"}},{default:g(()=>[(f(!0),S(E,null,F(a.line.params.text,(l,o)=>(f(),S("p",{key:o},$(l),1))),128))]),_:1})]),_:1})}var ys=w(vs,[["render",gs]]);const hs={props:["line","decision"],emits:["selectDecision"],methods:{selectDecision(e){this.$emit("selectDecision",e)}},components:{TagDescription:ss,TagCharacterSpeech:is,TagDecision:us,TagImage:fs,TagSubtitle:ys}};function ps(e,t,a,s,n,r){const l=D("TagDescription"),o=D("TagSubtitle"),i=D("TagCharacterSpeech"),c=D("TagDecision"),d=D("TagImage");return a.line.tag==="DESCRIPTION"?(f(),p(l,{key:0,line:a.line},null,8,["line"])):a.line.tag==="SUBTITLE"?(f(),p(o,{key:1,line:a.line},null,8,["line"])):a.line.tag==="CHARACTER_SPEECH"?(f(),p(i,{key:2,line:a.line},null,8,["line"])):a.line.tag==="DECISION"?(f(),p(c,{key:3,line:a.line,decision:a.decision,onSelectDecision:r.selectDecision},null,8,["line","decision","onSelectDecision"])):["IMAGE","BACKGROUND"].includes(a.line.tag)?(f(),p(d,{key:4,line:a.line},null,8,["line"])):I("",!0)}var _s=w(hs,[["render",ps]]);const Ss={props:["renderBlock"],emits:["selectCharImage"],data(){return{decision:{}}},methods:{selectDecision({id:e,value:t}){this.decision[e]=t},selectCharImage(e){this.$emit("selectCharImage",e)}},computed:{items(){let e=[],t=1,a;for(let s=0;s<this.renderBlock.length;s++){let n=this.renderBlock[s];switch(n.tag){case"DECISION":{a=this.decision[t]||n.params.options[0].value,n.params.id=t,e.push(n),t+=1;break}case"PREDICATE":{let r=n.params.references;if(a){if(!r.includes(a)){for(let l=s+1;l<this.renderBlock.length;l++)if(this.renderBlock[l].tag==="PREDICATE"){s=l-1;break}else if(l===this.renderBlock.length-1){s=l;break}}}else a=null;break}default:{e.push(n);break}}}return e}},components:{StoryReaderRenderItem:_s}};function Cs(e,t,a,s,n,r){const l=D("StoryReaderRenderItem");return f(!0),S(E,null,F(r.items,(o,i)=>(f(),p(l,{key:i,line:o,decision:n.decision,onSelectDecision:r.selectDecision,onSelectCharImage:r.selectCharImage},null,8,["line","decision","onSelectDecision","onSelectCharImage"]))),128)}var Es=w(Ss,[["render",Cs]]);const Ts={props:["value","src"],computed:{show:{get(){return this.value},set(e){this.$emit("set",e)}}}};function bs(e,t,a,s,n,r){return f(),p(Zt,{modelValue:r.show,"onUpdate:modelValue":t[0]||(t[0]=l=>r.show=l),width:"100%",height:"100%",class:"custom-overlay",onClick:t[1]||(t[1]=l=>r.show=!1)},{default:g(()=>[u(He,{src:a.src},null,8,["src"])]),_:1},8,["modelValue"])}var xs=w(Ts,[["render",bs]]),ks={format:"image/png",quality:.92,width:void 0,height:void 0,Canvas:void 0,crossOrigin:void 0},Is=function(e,t){return e===void 0&&(e=[]),t===void 0&&(t={}),new Promise(function(a){t=Object.assign({},ks,t);var s=t.Canvas?new t.Canvas:window.document.createElement("canvas"),n=t.Image||window.Image,r=e.map(function(o){return new Promise(function(i,c){o.constructor.name!=="Object"&&(o={src:o});var d=new n;d.crossOrigin=t.crossOrigin,d.onerror=function(){return c(new Error("Couldn't load image"))},d.onload=function(){return i(Object.assign({},o,{img:d}))},d.src=o.src})}),l=s.getContext("2d");a(Promise.all(r).then(function(o){var i=function(c){return t[c]||Math.max.apply(Math,o.map(function(d){return d.img[c]}))};return s.width=i("width"),s.height=i("height"),o.forEach(function(c){return l.globalAlpha=c.opacity?c.opacity:1,l.drawImage(c.img,c.x||0,c.y||0)}),t.Canvas&&t.format==="image/jpeg"?new Promise(function(c,d){s.toDataURL(t.format,{quality:t.quality,progressive:!1},function(v,m){if(v){d(v);return}c(m)})}):s.toDataURL(t.format,t.quality)}))})};function Rs(e){const t=V(),a=V(!1);if(La){const s=new IntersectionObserver(n=>{e==null||e(n,s),a.value=!!n.find(r=>r.isIntersecting)});Aa(()=>{s.disconnect()}),j(t,(n,r)=>{r&&(s.unobserve(r),a.value=!1),n&&s.observe(n)},{flush:"post"})}return{intersectionRef:t,isIntersecting:a}}const Ge=Z({name:"VProgressLinear",props:h(h(h({active:{type:Boolean,default:!0},bgColor:String,bgOpacity:[Number,String],bufferValue:{type:[Number,String],default:0},clickable:Boolean,color:String,height:{type:[Number,String],default:4},indeterminate:Boolean,max:{type:[Number,String],default:100},modelValue:{type:[Number,String],default:0},reverse:Boolean,stream:Boolean,striped:Boolean,roundedBar:Boolean},Ne()),ie()),_e()),emits:{"update:modelValue":e=>!0},setup(e,t){let{slots:a}=t;const s=Fe(e,"modelValue"),{isRtl:n}=At(),{themeClasses:r}=Ce(e),{textColorClasses:l,textColorStyles:o}=Da(e,"color"),{backgroundColorClasses:i,backgroundColorStyles:c}=ye(C(()=>e.bgColor||e.color)),{backgroundColorClasses:d,backgroundColorStyles:v}=ye(e,"color"),{roundedClasses:m}=Me(e),{intersectionRef:_,isIntersecting:y}=Rs(),O=C(()=>parseInt(e.max,10)),b=C(()=>parseInt(e.height,10)),P=C(()=>parseFloat(e.bufferValue)/O.value*100),L=C(()=>parseFloat(s.value)/O.value*100),A=C(()=>n.value!==e.reverse),B=C(()=>e.indeterminate?"fade-transition":"slide-x-transition"),U=C(()=>e.bgOpacity==null?e.bgOpacity:parseFloat(e.bgOpacity));function N(M){if(!_.value)return;const{left:K,right:Y,width:G}=_.value.getBoundingClientRect(),T=A.value?G-M.clientX+(Y-G):M.clientX-K;s.value=Math.round(T/G*O.value)}return()=>u(e.tag,{ref:_,class:["v-progress-linear",{"v-progress-linear--active":e.active&&y.value,"v-progress-linear--reverse":A.value,"v-progress-linear--rounded":e.rounded,"v-progress-linear--rounded-bar":e.roundedBar,"v-progress-linear--striped":e.striped},m.value,r.value],style:{height:e.active?k(b.value):0,"--v-progress-linear-height":k(b.value)},role:"progressbar","aria-valuemin":"0","aria-valuemax":e.max,"aria-valuenow":e.indeterminate?void 0:L.value,onClick:e.clickable&&N},{default:()=>[e.stream&&u("div",{class:["v-progress-linear__stream",l.value],style:x(h({},o.value),{[A.value?"left":"right"]:k(-b.value),borderTop:`${k(b.value/2)} dotted`,opacity:U.value,top:`calc(50% - ${k(b.value/4)})`,width:k(100-P.value,"%"),"--v-progress-linear-stream-to":k(b.value*(A.value?1:-1))})},null),u("div",{class:["v-progress-linear__background",i.value],style:[c.value,{opacity:U.value,width:k(e.stream?P.value:100,"%")}]},null),u(ve,{name:B.value},{default:()=>[e.indeterminate?u("div",{class:"v-progress-linear__indeterminate"},[["long","short"].map(M=>u("div",{key:M,class:["v-progress-linear__indeterminate",M,d.value],style:v.value},null))]):u("div",{class:["v-progress-linear__determinate",d.value],style:[v.value,{width:k(L.value,"%")}]},null)]}),a.default&&u("div",{class:"v-progress-linear__content"},[a.default({value:L.value,buffer:P.value})])]})}}),ws={props:["storyData"],inject:["charactersSprites"],data(){return{isReady:!1,renderBlocks:[],imagesUrl:{},charImageSrc:"",charImageDialog:!1}},created(){this.$watch(()=>this.storyData,()=>{this.prepareRenderBlocks()},{immediate:!0})},methods:{getCharNameAndNumFromSpriteName(e){let t="1",a="1",s="";return e.split("#").length>1?([s,t]=e.split("#"),[t,a]=t.split("$")):s=e.split("#")[0],{name:s,num:t,group:a||"1"}},async prepareRenderBlocks(){var l;this.isReady=!1;let e=[],t=[],a,s,n,r={IMAGE:{},BACKGROUND:{},CHARACTER:{}};for(let o=0;o<this.storyData.lines.length;o++){let i=this.storyData.lines[o];switch(i.tag){case"DESCRIPTION":{a?a.tag==="DESCRIPTION"?a.params.text.push(i.params.text):(t.push(a),a={tag:"DESCRIPTION",params:{text:[i.params.text]}}):a={tag:"DESCRIPTION",params:{text:[i.params.text]}};break}case"SUBTITLE":{i.params.text&&(a?a.tag==="SUBTITLE"?a.params.text.push(i.params.text):(t.push(a),a={tag:"SUBTITLE",params:{text:[i.params.text]}}):a={tag:"SUBTITLE",params:{text:[i.params.text]}});break}case"CHARACTER_SPEECH":{let c=x(h({},i.params),{text:[i.params.text],image:n});a?a.tag==="CHARACTER_SPEECH"&&((l=a.params)==null?void 0:l.name.localeCompare(i.params.name,void 0,{sensitivity:"base"}))===0?a.params.text.push(i.params.text):(t.push(a),a={tag:"CHARACTER_SPEECH",params:c}):a={tag:"CHARACTER_SPEECH",params:c};break}case"MULTILINE":{let c={tag:"CHARACTER_SPEECH",params:x(h({},i.params),{text:[i.params.other],image:n})};a&&t.push(a),a=c;break}case"DECISION":{a&&t.push(a);let c=i.params.options.split(";"),d=i.params.values.split(";"),v=!1;if(s){for(let m of d)if(s.options.includes(m)){v=!0;break}}v&&(e.push(t),t=[],a=null),(!s||v)&&(s={options:d}),a=x(h({},i),{params:{options:c.map((m,_)=>({text:m,value:d[_]}))}});break}case"PREDICATE":{a&&t.push(a);let c=i.params.references.split(";");a=x(h({},i),{params:{references:c}});break}case"IMAGE":{a&&t.push(a),a=i;break}case"BACKGROUND":{a&&t.push(a),a=i;break}case"CHARACTER":{if(i.params.focus)switch(parseInt(i.params.focus)){case 1:{n=i.params.name;break}case 2:{n=i.params.name2;break}default:{n=void 0;break}}else n=i.params.name;break}}if(["IMAGE","BACKGROUND","CHARACTER"].includes(i.tag)){if(["IMAGE","BACKGROUND"].includes(i.tag)&&i.params.image&&!(i.params.image in r[i.tag])){let c=new Image,d;i.tag==="IMAGE"&&(d=`${H}/images/avg/imgs/${i.params.image}.png`),i.tag==="BACKGROUND"&&(d=`${H}/images/avg/bg/${i.params.image}.png`),c.src=d,r[i.tag][i.params.image]=d}if(i.tag==="CHARACTER"&&!(n in r.CHARACTER)&&n){let c,d,{name:v,num:m,group:_}=this.getCharNameAndNumFromSpriteName(n);v=v.toLocaleLowerCase();let y=this.charactersSprites[v];if(y[_].sprites[m].isWholeBody===0){let O=Object.keys(y[_].sprites)[Object.keys(y[_].sprites).length-1];if(O!==m){let b=y[_].sprites[O].sprite,P=`${H}/images/avg/characters/${v}/${b}`,L=y[_].sprites[m].sprite,A=`${H}/images/avg/characters/${v}/${L}`;c=await Is([{src:P,x:0,y:0},{src:A,x:y[_].facePos.x,y:y[_].facePos.y}],{crossOrigin:"Anonymous"})}}else d=y[_].sprites[m].sprite,c=`${H}/images/avg/characters/${v}/${d}`;r.CHARACTER[n]=c}}}t[t.length-1]!==a&&t.push(a),e[e.length-1]!==t&&e.push(t),this.renderBlocks=e,this.imagesUrl=r,this.isReady=!0},selectCharImage(e){e&&(this.charImageSrc=this.imagesUrl.CHARACTER[e],this.charImageDialog=!0)}},components:{RenderBlock:Es,CharImageDialog:xs}};function Os(e,t,a,s,n,r){const l=D("RenderBlock"),o=D("CharImageDialog");return f(),S(E,null,[n.isReady?I("",!0):(f(),p(Ge,{key:0,indeterminate:""})),u(Dt,null,{default:g(()=>[(f(!0),S(E,null,F(n.renderBlocks,(i,c)=>(f(),p(l,{key:c,renderBlock:i,onSelectCharImage:r.selectCharImage},null,8,["renderBlock","onSelectCharImage"]))),128))]),_:1}),u(o,{modelValue:n.charImageDialog,"onUpdate:modelValue":t[0]||(t[0]=i=>n.charImageDialog=i),src:n.charImageSrc,onSet:t[1]||(t[1]=i=>n.charImageDialog=!1)},null,8,["modelValue","src"])],64)}var Ls=w(ws,[["render",Os]]);const As={props:["storyFile"],data(){return{loading:!0,storyData:{lines:[],tagCount:{}},storyInfo:void 0}},created(){this.$watch(()=>[this.storyFile],()=>{this.getStoryInfo()},{immediate:!0})},methods:{getStoryInfo(){this.storyFile.file&&(this.loading=!0,fetch(`${H}/story/${this.storyFile.server}/${this.storyFile.file}.txt`).then(e=>e.text().then(t=>{let a=ts(t);this.storyData=a,this.loading=!1})))}},components:{StoryReaderRender:Ls}};function Ds(e,t,a,s,n,r){const l=D("StoryReaderRender");return f(),S(E,null,[n.loading?(f(),p(Ge,{key:0,indeterminate:""})):I("",!0),n.loading?I("",!0):(f(),p(l,{key:1,storyData:n.storyData},null,8,["storyData"]))],64)}var Ps=w(As,[["render",Ds]]);const Bs={props:["storyType","storyId","storyIndex","server"],async created(){this.loading=!0,await this.getStoryTable(),await this.getCharacterSpritesTable(),this.loading=!1},data(){return{loading:!0,storyTable:{},charactersSprites:{},storyFile:{file:"",server:""}}},provide(){return{charactersSprites:C(()=>this.charactersSprites)}},methods:{async getStoryTable(){await fetch(`${H}/table/story_review_table.json`).then(e=>e.json()).then(e=>{this.storyTable=e})},async getCharacterSpritesTable(){await fetch(`${H}/table/characters_sprites_table.json`).then(e=>e.json()).then(e=>{this.charactersSprites=e})},selectFile({file:e,server:t}){this.storyFile={file:e,server:t}}},components:{StorySelector:es,StoryReaderMain:Ps}};function $s(e,t,a,s,n,r){const l=D("StorySelector"),o=D("StoryReaderMain");return f(),S(E,null,[n.loading?(f(),p(Ge,{key:0,indeterminate:""})):I("",!0),n.loading?I("",!0):(f(),S(E,{key:1},[u(l,{storyTable:n.storyTable,onSelectFile:r.selectFile},null,8,["storyTable","onSelectFile"]),u(o,{storyFile:n.storyFile},null,8,["storyFile"])],64))],64)}var Ms=w(Bs,[["render",$s]]);export{Ms as default};
