var W=Object.defineProperty,X=Object.defineProperties;var Y=Object.getOwnPropertyDescriptors;var $=Object.getOwnPropertySymbols;var Z=Object.prototype.hasOwnProperty,ee=Object.prototype.propertyIsEnumerable;var P=(t,a,e)=>a in t?W(t,a,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[a]=e,u=(t,a)=>{for(var e in a||(a={}))Z.call(a,e)&&P(t,e,a[e]);if($)for(var e of $(a))ee.call(a,e)&&P(t,e,a[e]);return t},_=(t,a)=>X(t,Y(a));import{_ as y}from"./index.d14d283f.js";import{o,p as h,I as g,J as R,K as k,c as f,w as v,a as d,j as te,L as A,M as ae,h as L,f as se,r as C,q as D,i as ne,v as S,N as z,x as U,O as re,y as I,E as ie,P as j,Q as q,G as M,R as le,S as oe,U as ce,W as E,X as ue,Y as de,Z as me,_ as he,z as fe,C as pe,$ as ve,a0 as ge,a1 as ye,a2 as _e,a3 as Ce,D as xe}from"./vendor.16e44847.js";import{V as F}from"./VProgressLinear.2d44bb0f.js";const V=/\[(?<tag>.+?)\((?<params>.*)\)\]/,N=/\[(?<tag>.*)=(?<value>.*)\]/g,H=/\[(?<tag>.*)\]/,w=/(?<name>\w*?)\s*=\s*(?<value>".*?"|[^",)\]\s]*)/g,O=/\[[Nn][Aa][Mm][Ee]="(?<name>.*)"(?<params>.*)\]\s*(?<text>.*)/g,ke=t=>{let a={lines:[],tagCount:{},otherLines:[]},e=t.split(`
`),i=n=>{n in a.tagCount||(a.tagCount[n]=0),a.tagCount[n]+=1};for(const n of e)if(n.match(V)){let{tag:s,params:r}=V.exec(n).groups;s=s.toUpperCase();let l={},c;for(;(c=w.exec(r))!==null;){let{name:m,value:p}=c.groups;l[m]=p.replace(/"/g,"")}a.lines.push({tag:s,params:l}),i(s)}else if(n.match(O)){let{name:s,params:r,text:l}=O.exec(n).groups,c={},m;for(;(m=w.exec(r))!==null;){let{name:p,value:x}=m.groups;c[p]=x.replace(/"/g,"")}a.lines.push({tag:"CHARACTER_SPEECH",params:_(u({},c),{name:s,text:l})}),i("CHARACTER_SPEECH")}else if(n.match(N)){let{tag:s,value:r}=N.exec(n).groups;s=s.toUpperCase(),a.lines.push({tag:s,params:{[s]:r}}),i(s)}else if(n.match(H)){let{tag:s}=H.exec(n).groups;s=s.toUpperCase(),a.lines.push({tag:s,params:{}}),i(s)}else if(n.length>0&&n.indexOf("//"!==0)){let s="DESCRIPTION";a.lines.push({tag:s,params:{text:n}}),i(s)}else a.otherLines.push(n);return a},Re={props:["line"]},De={class:"pa-3"};function Se(t,a,e,i,n,s){return o(),h("div",De,[(o(!0),h(g,null,R(e.line.params.text,(r,l)=>(o(),h("p",{key:l},k(r),1))),128))])}var Ie=y(Re,[["render",Se]]);const Ee={props:["line"]},be={class:"font-weight-bold text-grey"};function Be(t,a,e,i,n,s){return o(),f(ae,null,{default:v(()=>[d(A,{cols:"12",sm:"2",class:"pb-0 pb-sm-3"},{default:v(()=>[te("p",be,k(e.line.params.name),1)]),_:1}),d(A,{cols:"12",sm:"8",class:"pt-0 pt-sm-3"},{default:v(()=>[(o(!0),h(g,null,R(e.line.params.text,(r,l)=>(o(),h("p",{key:l},k(r),1))),128))]),_:1})]),_:1})}var Te=y(Ee,[["render",Be]]);const $e={props:["line","decision"],emits:["selectDecision"],methods:{getVariant(t){let a="text";return(this.decision[this.line.params.id]||this.line.params.options[0].value)===t&&(a="outlined"),a},selectDecision(t){this.$emit("selectDecision",{id:this.line.params.id,value:t})}}},Pe={class:"d-flex flex-column pa-3"};function Ae(t,a,e,i,n,s){return o(),h("div",Pe,[(o(!0),h(g,null,R(e.line.params.options,(r,l)=>(o(),f(se,{key:l,variant:s.getVariant(r.value),onClick:c=>s.selectDecision(r.value)},{default:v(()=>[L(k(r.text),1)]),_:2},1032,["variant","onClick"]))),128))])}var Ve=y($e,[["render",Ae]]);const Ne={props:["line","decision"],emits:["selectDecision"],methods:{selectDecision(t){this.$emit("selectDecision",t)}},components:{TagDescription:Ie,TagCharacterSpeech:Te,TagDecision:Ve}};function He(t,a,e,i,n,s){const r=C("TagDescription"),l=C("TagCharacterSpeech"),c=C("TagDecision");return e.line.tag==="DESCRIPTION"?(o(),f(r,{key:0,line:e.line},null,8,["line"])):e.line.tag==="CHARACTER_SPEECH"?(o(),f(l,{key:1,line:e.line},null,8,["line"])):e.line.tag==="DECISION"?(o(),f(c,{key:2,line:e.line,decision:e.decision,onSelectDecision:s.selectDecision},null,8,["line","decision","onSelectDecision"])):D("",!0)}var we=y(Ne,[["render",He]]);const Oe={props:["renderBlock"],data(){return{decision:{}}},methods:{selectDecision({id:t,value:a}){this.decision[t]=a}},computed:{items(){let t=[],a=1,e;for(let i=0;i<this.renderBlock.length;i++){let n=this.renderBlock[i];switch(n.tag){case"DECISION":{e=this.decision[a]||n.params.options[0].value,n.params.id=a,t.push(n),a+=1;break}case"PREDICATE":{if(n.params.references.includes(e))e=null;else for(let s=i+1;s<this.renderBlock.length;s++)if(this.renderBlock[s].tag==="PREDICATE"){i=s-1;break}else if(s===this.renderBlock.length-1){i=s;break}break}default:{t.push(n);break}}}return t}},components:{StoryReaderRenderItem:we}};function Le(t,a,e,i,n,s){const r=C("StoryReaderRenderItem");return o(!0),h(g,null,R(s.items,(l,c)=>(o(),f(r,{key:c,line:l,decision:n.decision,onSelectDecision:s.selectDecision},null,8,["line","decision","onSelectDecision"]))),128)}var ze=y(Oe,[["render",Le]]);const Ue={props:["storyData"],data(){return{isReady:!1,renderBlocks:[]}},created(){this.$watch(()=>this.storyData,()=>{this.prepareRenderBlocks()},{immediate:!0})},methods:{prepareRenderBlocks(){var n;this.isReady=!1;let t=[],a=[],e,i;for(let s=0;s<this.storyData.lines.length;s++){let r=this.storyData.lines[s];switch(r.tag){case"DESCRIPTION":{e?e.tag==="DESCRIPTION"?e.params.text.push(r.params.text):(a.push(e),e={tag:"DESCRIPTION",params:{text:[r.params.text]}}):e={tag:"DESCRIPTION",params:{text:[r.params.text]}};break}case"CHARACTER_SPEECH":{e?e.tag==="CHARACTER_SPEECH"&&((n=e.params)==null?void 0:n.name.localeCompare(r.params.name,void 0,{sensitivity:"base"}))===0?e.params.text.push(r.params.text):(a.push(e),e={tag:"CHARACTER_SPEECH",params:_(u({},r.params),{text:[r.params.text]})}):e={tag:"CHARACTER_SPEECH",params:_(u({},r.params),{text:[r.params.text]})};break}case"DECISION":{e&&a.push(e);let l=r.params.options.split(";"),c=r.params.values.split(";"),m=!1;if(i){for(let p of c)if(i.options.includes(p)){m=!0;break}}m&&(t.push(a),a=[],e=null),(!i||m)&&(i={options:c}),e=_(u({},r),{params:{options:l.map((p,x)=>({text:p,value:c[x]}))}});break}case"PREDICATE":{e&&a.push(e);let l=r.params.references.split(";");e=_(u({},r),{params:{references:l}});break}}}a[a.length-1]!==e&&a.push(e),t[t.length-1]!==a&&t.push(a),this.renderBlocks=t,this.isReady=!0}},components:{RenderBlock:ze}};function je(t,a,e,i,n,s){const r=C("RenderBlock");return o(),h(g,null,[n.isReady?D("",!0):(o(),f(F,{key:0,indeterminate:""})),d(ne,null,{default:v(()=>[(o(!0),h(g,null,R(n.renderBlocks,(l,c)=>(o(),f(r,{key:c,renderBlock:l},null,8,["renderBlock"]))),128))]),_:1})],64)}var qe=y(Ue,[["render",je]]);const Me=S({name:"VAvatar",props:u(u(u(u({color:String,left:Boolean,right:Boolean,icon:String,image:String},z()),U()),re()),I()),setup(t,a){let{slots:e}=a;const{backgroundColorClasses:i,backgroundColorStyles:n}=ie(j(t,"color")),{densityClasses:s}=q(t,"v-avatar"),{roundedClasses:r}=M(t,"v-avatar"),{sizeClasses:l,sizeStyles:c}=le(t,"v-avatar");return()=>{var m;return d(t.tag,{class:["v-avatar",{"v-avatar--left":t.left,"v-avatar--right":t.right},i.value,s.value,r.value,l.value],style:[n.value,c.value]},{default:()=>[t.image&&d(oe,{src:t.image,alt:""},null,8,["src"]),t.icon&&!t.image&&d(ce,{icon:t.icon},null,8,["icon"]),(m=e.default)==null?void 0:m.call(e)],_:1},8,["class","style"])}}}),Fe=E("v-banner-actions"),Ge=S({name:"VBannerAvatar",props:u({left:Boolean,right:Boolean},I()),setup(t,a){let{slots:e}=a;return()=>d(t.tag,{class:["v-banner-avatar",{"v-banner-avatar--start":t.left,"v-banner-avatar--end":t.right}]},e,8,["class"])}}),Je=E("v-banner-content"),G=E("v-banner-text"),Ke=S({name:"VBanner",props:u(u(u(u(u(u(u(u({avatar:String,color:String,icon:String,lines:{type:String,default:"one"},sticky:Boolean,text:String},ue()),z()),de()),me()),he()),U()),I()),fe()),setup(t,a){let{slots:e}=a;const{themeClasses:i}=pe(t),{borderClasses:n}=ve(t,"v-banner"),{densityClasses:s}=q(t,"v-banner"),{dimensionStyles:r}=ge(t),{mobile:l}=ye(),{elevationClasses:c}=_e(t),{positionClasses:m,positionStyles:p}=Ce(t,"v-banner"),{roundedClasses:x}=M(t,"v-banner"),{textColorClasses:J,textColorStyles:K}=xe(j(t,"color"));return()=>{var b;const B=!!(t.avatar||t.icon||e.avatar||e.icon),T=!!(t.text||e.text),Q=B||T||e.default;return d(t.tag,{class:["v-banner",{"v-banner--mobile":l.value,"v-banner--sticky":t.sticky,[`v-banner--${t.lines}-line`]:!0},n.value,s.value,c.value,m.value,x.value,J.value,i.value],style:[r.value,p.value,K.value],role:"banner"},{default:()=>[Q&&d(Je,null,{default:()=>[B&&d(Ge,null,{default:()=>[e.avatar?e.avatar():d(Me,{density:t.density,icon:t.icon,image:t.avatar},null,8,["density","icon","image"])]}),T&&d(G,null,{default:()=>[e.text?e.text():t.text]}),(b=e.default)==null?void 0:b.call(e)],_:1}),e.actions&&d(Fe,null,{default:e.actions})],_:1},8,["class","style"])}}}),Qe={props:["storyId","storyIndex","server","storyTable"],data(){return{loading:!0,storyInfo:{},storyData:{lines:[],tagCount:{}}}},created(){this.$watch(()=>[this.storyId,this.storyIndex,this.server],()=>{this.getStoryInfo()},{immediate:!0})},methods:{getStoryInfo(){let t=this.storyTable.find(a=>a.id===this.storyId);if(t||this.$router.push("/story-reader"),t){Object.keys(t.name).includes(this.server)||this.$router.push({path:"/story-reader",query:{storyId:this.storyId}});let a=t.story.find(e=>e.sort===parseInt(this.storyIndex));a||this.$router.push({path:"/story-reader",query:{storyId:this.storyId,server:this.server}}),this.storyInfo=a}}},computed:{storyName(){return`${this.storyInfo.code?`${this.storyInfo.code}: `:""}${this.storyInfo.name[this.server]}`}},watch:{storyInfo(){this.loading=!0,fetch(`/arknights-assets/story/${this.server}/${this.storyInfo.file}.txt`).then(t=>t.text().then(a=>{let e=ke(a);this.storyData=e,this.loading=!1}))}},components:{StoryReaderRender:qe}};function We(t,a,e,i,n,s){const r=C("StoryReaderRender");return o(),h(g,null,[d(Ke,null,{default:v(()=>[d(G,null,{default:v(()=>[L(k(s.storyName),1)]),_:1})]),_:1}),n.loading?(o(),f(F,{key:0,indeterminate:""})):D("",!0),n.loading?D("",!0):(o(),f(r,{key:1,storyData:n.storyData},null,8,["storyData"]))],64)}var tt=y(Qe,[["render",We]]);export{tt as default};
