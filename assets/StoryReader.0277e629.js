import{u as te,a as $e}from"./StoryReaderStore.7eb69d57.js";import{u as Re}from"./CharacterStore.0cb8ef58.js";import{m as ae,u as oe,V as ne,R as xe,C as Be,a as Ce,b as Le,c as ke,d as De}from"./CharImageDialog.92cc772b.js";import{d as U,h as p,l as O,_ as q,c as C,w as T,o as V,f as s,i as z,r as le,b as re,t as se,F as P,j as _,s as Ee,u as ie,k as ue,p as Me,m as Z,n as L,q as G,v as Ie,x as A,y as Ae,e as N,z as ce,I as Pe,C as Ne,A as de,B as He,D as Oe,E as W,G as We,T as ze,H as j,J as Xe,K as Ye,L as H}from"./index.9343c9cb.js";import{V as je}from"./VDialog.e1527ab2.js";import{V as ve,a as me,b as Fe,u as fe,c as Ue}from"./VList.63621a54.js";import{V as qe,a as Ze}from"./VCard.8884702a.js";import{c as Ge,m as ge,a as he,b as ye,u as be,d as pe,e as we,f as Se,V as Je,g as Ke,h as Ve,i as Qe}from"./router.753e3c43.js";import{m as X,u as E}from"./tag.5404cb9c.js";import{V as et}from"./VContainer.305eee74.js";import"./VRow.5c0385be.js";/* empty css              */const tt=Ge("flex-grow-1","div","VSpacer"),at=U({name:"LanguageSelectorDialog",props:{options:{type:Array,default:()=>[]}},emits:["selectLanguage"],setup(e){return{languageOptions:p(()=>O.filter(n=>{var t;return(t=e.options)==null?void 0:t.includes(n.id)}))}}});function ot(e,a,n,t,i,o){return V(),C(je,null,{default:T(()=>[s(qe,null,{default:T(()=>[s(ve,null,{default:T(()=>[(V(!0),z(P,null,le(e.languageOptions,l=>(V(),C(me,{key:l.id,onClick:r=>e.$emit("selectLanguage",l.id)},{default:T(()=>[re(se(l.name),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1})]),_:1})}const nt=q(at,[["render",ot]]),lt=U({namme:"StoryReaderAppBar",setup(){const e=ie(),a=te(),n=_(!1),t=_(!1),i=p(()=>a.storySet),o=p(()=>a.story),l=p(()=>{let d=[];return e.name==="render-story"?o&&(d=O.filter(u=>{var c;return o.value?u.id in((c=o.value)==null?void 0:c.name):!1}).map(u=>u.id)):e.name==="select-story"?i&&(d=O.filter(u=>{var c;return i.value?u.id in((c=i.value)==null?void 0:c.name):!1}).map(u=>u.id)):d=O.map(u=>u.id),d});return{drawer:n,selectLanguageDialog:t,availableLanguages:l,selectLanguage:d=>{a.setLanguage(d),t.value=!1},storyType:Ee}},components:{LanguageSelectorDialog:nt}});const rt=ue()({name:"VToolbarTitle",props:{text:String,...X()},setup(e,a){let{slots:n}=a;return E(()=>{var t;const i=!!(n.default||n.text||e.text);return s(e.tag,{class:"v-toolbar-title"},{default:()=>[i&&s("div",{class:"v-toolbar-title__placeholder"},[n.text?n.text():e.text,(t=n.default)==null?void 0:t.call(n)])]})}),{}}});function st(e){for(var a=arguments.length,n=new Array(a>1?a-1:0),t=1;t<a;t++)n[t-1]=arguments[t];return new Proxy(e,{get(i,o){if(Reflect.has(i,o))return Reflect.get(i,o);for(const l of n)if(l.value&&Reflect.has(l.value,o)){const r=Reflect.get(l.value,o);return typeof r=="function"?r.bind(l.value):r}},getOwnPropertyDescriptor(i,o){const l=Reflect.getOwnPropertyDescriptor(i,o);if(l)return l;for(const r of n){if(!r.value)continue;const d=Reflect.getOwnPropertyDescriptor(r.value,o);if(d)return d}for(const r of n){let d=r.value&&Object.getPrototypeOf(r.value);for(;d;){const u=Reflect.getOwnPropertyDescriptor(d,o);if(u)return u;d=Object.getPrototypeOf(d)}}}})}const it=[null,"prominent","default","comfortable","compact"],Te=Me({absolute:Boolean,collapse:Boolean,color:String,density:{type:String,default:"default",validator:e=>it.includes(e)},extended:Boolean,extensionHeight:{type:[Number,String],default:48},flat:Boolean,floating:Boolean,height:{type:[Number,String],default:64},image:String,title:String,...ge(),...he(),...ye(),...X({tag:"header"}),...Z()},"v-toolbar"),F=ue()({name:"VToolbar",props:Te(),setup(e,a){var n;let{slots:t}=a;const{backgroundColorClasses:i,backgroundColorStyles:o}=be(L(e,"color")),{borderClasses:l}=pe(e),{elevationClasses:r}=we(e),{roundedClasses:d}=Se(e),{themeClasses:u}=G(e),c=_(!!(e.extended||(n=t.extension)!=null&&n.call(t))),y=p(()=>parseInt(Number(e.height)+(e.density==="prominent"?Number(e.height):0)-(e.density==="comfortable"?8:0)-(e.density==="compact"?16:0),10)),v=p(()=>c.value?parseInt(Number(e.extensionHeight)+(e.density==="prominent"?Number(e.extensionHeight):0)-(e.density==="comfortable"?4:0)-(e.density==="compact"?8:0),10):0);return Ie({VBtn:{variant:"text"}}),E(()=>{var h,B,$,w,k;const R=!!(e.title||t.title),D=!!(t.image||e.image),M=(h=t.extension)==null?void 0:h.call(t);return c.value=!!(e.extended||M),s(e.tag,{class:["v-toolbar",{"v-toolbar--absolute":e.absolute,"v-toolbar--collapse":e.collapse,"v-toolbar--flat":e.flat,"v-toolbar--floating":e.floating,[`v-toolbar--density-${e.density}`]:!0},i.value,l.value,r.value,d.value,u.value],style:[o.value]},{default:()=>[D&&s("div",{key:"image",class:"v-toolbar__image"},[s(Je,{defaults:{VImg:{cover:!0,src:e.image}}},{default:()=>[t.image?(B=t.image)==null?void 0:B.call(t):s(Ke,null,null)]})]),s("div",{class:"v-toolbar__content",style:{height:A(y.value)}},[t.prepend&&s("div",{class:"v-toolbar__prepend"},[($=t.prepend)==null?void 0:$.call(t)]),R&&s(rt,{key:"title",text:e.title},{text:t.title}),(w=t.default)==null?void 0:w.call(t),t.append&&s("div",{class:"v-toolbar__append"},[(k=t.append)==null?void 0:k.call(t)])]),s(Fe,null,{default:()=>[c.value&&s("div",{class:"v-toolbar__extension",style:{height:A(v.value)}},[M])]})]})}),st({contentHeight:y,extensionHeight:v})}});function ut(e){var a;return Ae(e,Object.keys((a=F==null?void 0:F.props)!=null?a:{}))}const ct=N({name:"VAppBar",props:{modelValue:{type:Boolean,default:!0},location:{type:String,default:"top",validator:e=>["top","bottom"].includes(e)},...Te(),...ae(),height:{type:[Number,String],default:64}},emits:{"update:modelValue":e=>!0},setup(e,a){let{slots:n}=a;const t=_(),i=Ve(e,"modelValue"),o=p(()=>{var r,d,u,c;const y=(r=(d=t.value)==null?void 0:d.contentHeight)!=null?r:0,v=(u=(c=t.value)==null?void 0:c.extensionHeight)!=null?u:0;return y+v}),{layoutItemStyles:l}=oe({id:e.name,order:p(()=>parseInt(e.order,10)),position:L(e,"location"),layoutSize:o,elementSize:o,active:i,absolute:L(e,"absolute")});return E(()=>{const[r]=ut(e);return s(F,ce({ref:t,class:["v-app-bar",{"v-app-bar--bottom":e.location==="bottom"}],style:{...l.value,height:void 0}},r),n)}),{}}}),dt=N({name:"VAppBarNavIcon",props:{icon:{type:Pe,default:"$menu"}},setup(e,a){let{slots:n}=a;return E(()=>s(ne,{class:"v-app-bar-nav-icon",icon:e.icon},n)),{}}});const vt=100,mt=20;function Q(e){const a=1.41421356237;return(e<0?-1:1)*Math.sqrt(Math.abs(e))*a}function ee(e){if(e.length<2)return 0;if(e.length===2)return e[1].t===e[0].t?0:(e[1].d-e[0].d)/(e[1].t-e[0].t);let a=0;for(let n=e.length-1;n>0;n--){if(e[n].t===e[n-1].t)continue;const t=Q(a),i=(e[n].d-e[n-1].d)/(e[n].t-e[n-1].t);a+=(i-t)*Math.abs(i),n===e.length-1&&(a*=.5)}return Q(a)*1e3}function ft(){const e={};function a(i){Array.from(i.changedTouches).forEach(o=>{var l;((l=e[o.identifier])!=null?l:e[o.identifier]=new Ne(mt)).push([i.timeStamp,o])})}function n(i){Array.from(i.changedTouches).forEach(o=>{delete e[o.identifier]})}function t(i){var o;const l=(o=e[i])==null?void 0:o.values().reverse();if(!l)throw new Error(`No samples for touch id ${i}`);const r=l[0],d=[],u=[];for(const c of l){if(r[0]-c[0]>vt)break;d.push({t:c[0],d:c[1].clientX}),u.push({t:c[0],d:c[1].clientY})}return{x:ee(d),y:ee(u),get direction(){const{x:c,y}=this,[v,h]=[Math.abs(c),Math.abs(y)];return v>h&&c>=0?"right":v>h&&c<=0?"left":h>v&&y>=0?"down":h>v&&y<=0?"up":gt()}}}return{addMovement:a,endTouch:n,getVelocity:t}}function gt(){throw new Error}function ht(e){let{isActive:a,isTemporary:n,width:t,touchless:i,position:o}=e;de(()=>{window.addEventListener("touchstart",k,{passive:!0}),window.addEventListener("touchmove",R,{passive:!1}),window.addEventListener("touchend",D,{passive:!0})}),He(()=>{window.removeEventListener("touchstart",k),window.removeEventListener("touchmove",R),window.removeEventListener("touchend",D)});const l=p(()=>o.value!=="bottom"),{addMovement:r,endTouch:d,getVelocity:u}=ft();let c=!1;const y=_(!1),v=_(0),h=_(0);let B;function $(m,g){return(o.value==="left"?m:o.value==="right"?document.documentElement.clientWidth-m:o.value==="bottom"?document.documentElement.clientHeight-m:I())-(g?t.value:0)}function w(m){let g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;const f=o.value==="left"?(m-h.value)/t.value:o.value==="right"?(document.documentElement.clientWidth-m-h.value)/t.value:o.value==="bottom"?(document.documentElement.clientHeight-m-h.value)/t.value:I();return g?Math.max(0,Math.min(1,f)):f}function k(m){if(i.value)return;const g=m.changedTouches[0].clientX,f=m.changedTouches[0].clientY,S=25,x=o.value==="left"?g<S:o.value==="right"?g>document.documentElement.clientWidth-S:o.value==="bottom"?f>document.documentElement.clientHeight-S:I(),b=a.value&&(o.value==="left"?g<t.value:o.value==="right"?g>document.documentElement.clientWidth-t.value:o.value==="bottom"?f>document.documentElement.clientHeight-t.value:I());(x||b||a.value&&n.value)&&(c=!0,B=[g,f],h.value=$(l.value?g:f,a.value),v.value=w(l.value?g:f),d(m),r(m))}function R(m){const g=m.changedTouches[0].clientX,f=m.changedTouches[0].clientY;if(c){if(!m.cancelable){c=!1;return}const x=Math.abs(g-B[0]),b=Math.abs(f-B[1]);(l.value?x>b&&x>3:b>x&&b>3)?(y.value=!0,c=!1):(l.value?b:x)>3&&(c=!1)}if(!y.value)return;m.preventDefault(),r(m);const S=w(l.value?g:f,!1);v.value=Math.max(0,Math.min(1,S)),S>1?h.value=$(l.value?g:f,!0):S<0&&(h.value=$(l.value?g:f,!1))}function D(m){if(c=!1,!y.value)return;r(m),y.value=!1;const g=u(m.changedTouches[0].identifier),f=Math.abs(g.x),S=Math.abs(g.y);(l.value?f>S&&f>400:S>f&&S>3)?a.value=g.direction===({left:"right",right:"left",bottom:"up"}[o.value]||I()):a.value=v.value>.5}const M=p(()=>y.value?{transform:o.value==="left"?`translateX(calc(-100% + ${v.value*t.value}px))`:o.value==="right"?`translateX(calc(100% - ${v.value*t.value}px))`:o.value==="bottom"?`translateY(calc(100% - ${v.value*t.value}px))`:I(),transition:"none"}:void 0);return{isDragging:y,dragProgress:v,dragStyles:M}}function I(){throw new Error}const yt=N({name:"VNavigationDrawer",props:{color:String,disableResizeWatcher:Boolean,disableRouteWatcher:Boolean,expandOnHover:Boolean,floating:Boolean,modelValue:{type:Boolean,default:null},permanent:Boolean,rail:Boolean,railWidth:{type:[Number,String],default:72},image:String,temporary:Boolean,touchless:Boolean,width:{type:[Number,String],default:256},location:{type:String,default:"left",validator:e=>["left","right","bottom"].includes(e)},...ge(),...he(),...ae(),...ye(),...X({tag:"nav"}),...Z()},emits:{"update:modelValue":e=>!0},setup(e,a){let{attrs:n,slots:t}=a;const{themeClasses:i}=G(e),{borderClasses:o}=pe(e),{backgroundColorClasses:l,backgroundColorStyles:r}=be(L(e,"color")),{elevationClasses:d}=we(e),{mobile:u}=Oe(),{roundedClasses:c}=Se(e),y=Qe(),v=Ve(e,"modelValue",null,b=>!!b),h=_(!1),{ssrBootStyles:B}=fe(),$=p(()=>e.rail&&e.expandOnHover&&h.value?Number(e.width):Number(e.rail?e.railWidth:e.width)),w=p(()=>!e.permanent&&(u.value||e.temporary));e.disableResizeWatcher||W(w,b=>!e.permanent&&(v.value=!b)),!e.disableRouteWatcher&&y&&W(y.currentRoute,()=>w.value&&(v.value=!1)),W(()=>e.permanent,b=>{b&&(v.value=!0)}),We(()=>{e.modelValue!=null||w.value||(v.value=e.permanent||!u.value)});const k=_(),{isDragging:R,dragProgress:D,dragStyles:M}=ht({isActive:v,isTemporary:w,width:$,touchless:L(e,"touchless"),position:L(e,"location")}),m=p(()=>{const b=w.value?0:e.rail&&e.expandOnHover?Number(e.railWidth):$.value;return R.value?b*D.value:b}),{layoutItemStyles:g,layoutRect:f,layoutItemScrimStyles:S}=oe({id:e.name,order:p(()=>parseInt(e.order,10)),position:L(e,"location"),layoutSize:m,elementSize:$,active:p(()=>v.value||R.value),disableTransitions:p(()=>R.value),absolute:L(e,"absolute")}),x=p(()=>({...R.value?{opacity:D.value*.2,transition:"none"}:void 0,...f.value?{left:A(f.value.left),right:A(f.value.right),top:A(f.value.top),bottom:A(f.value.bottom)}:void 0,...S.value}));return E(()=>{var b,Y,J,K;const _e=t.image||e.image;return s(P,null,[s(e.tag,ce({ref:k,onMouseenter:()=>h.value=!0,onMouseleave:()=>h.value=!1,class:["v-navigation-drawer",{"v-navigation-drawer--bottom":e.location==="bottom","v-navigation-drawer--end":e.location==="right","v-navigation-drawer--expand-on-hover":e.expandOnHover,"v-navigation-drawer--floating":e.floating,"v-navigation-drawer--is-hovering":h.value,"v-navigation-drawer--rail":e.rail,"v-navigation-drawer--start":e.location==="left","v-navigation-drawer--temporary":w.value,"v-navigation-drawer--active":v.value},i.value,l.value,o.value,d.value,c.value],style:[r.value,g.value,M.value,B.value]},n),{default:()=>[_e&&s("div",{key:"image",class:"v-navigation-drawer__img"},[t.image?(b=t.image)==null?void 0:b.call(t,{image:e.image}):s("img",{src:e.image,alt:""},null)]),t.prepend&&s("div",{class:"v-navigation-drawer__prepend"},[(Y=t.prepend)==null?void 0:Y.call(t)]),s("div",{class:"v-navigation-drawer__content"},[(J=t.default)==null?void 0:J.call(t)]),t.append&&s("div",{class:"v-navigation-drawer__append"},[(K=t.append)==null?void 0:K.call(t)])]}),s(ze,{name:"fade-transition"},{default:()=>[w.value&&(R.value||v.value)&&s("div",{class:"v-navigation-drawer__scrim",style:x.value,onClick:()=>v.value=!1},null)]})])}),{}}});function bt(e,a,n,t,i,o){const l=j("LanguageSelectorDialog");return V(),z(P,null,[s(yt,{modelValue:e.drawer,"onUpdate:modelValue":a[0]||(a[0]=r=>e.drawer=r),bottom:"",temporary:""},{default:T(()=>[s(ve,null,{default:T(()=>[(V(!0),z(P,null,le(e.storyType,(r,d)=>(V(),C(me,{key:d,to:{name:r.routeName}},{default:T(()=>[s(Ue,null,{default:T(()=>[re(se(r.name),1)]),_:2},1024)]),_:2},1032,["to"]))),128))]),_:1})]),_:1},8,["modelValue"]),s(ct,{density:"compact"},{default:T(()=>[s(dt,{variant:"text",onClick:a[1]||(a[1]=Xe(r=>e.drawer=!e.drawer,["stop"]))}),s(tt),s(ne,{variant:"text",icon:"mdi-translate",onClick:a[2]||(a[2]=r=>e.selectLanguageDialog=!0)})]),_:1}),s(l,{modelValue:e.selectLanguageDialog,"onUpdate:modelValue":a[3]||(a[3]=r=>e.selectLanguageDialog=r),options:e.availableLanguages,onSelectLanguage:e.selectLanguage},null,8,["modelValue","options","onSelectLanguage"])],64)}const pt=q(lt,[["render",bt]]),wt=U({name:"StoryReader",components:{RenderBlock:xe,CharImageDialog:Be,StoryReaderAppBar:pt},setup(){const e=ie(),a=te(),{getStoryTable:n}=$e(),{getCharacterTable:t}=Re(),{getCharacterSpriteTable:i}=Ce(),o=_(!0),l=_(!1),r=_([]),d=async()=>{o.value=!0;try{await n(),await t(),await i()}catch(u){r.value.push(u)}finally{o.value=!1,l.value=!0}};return de(async()=>{await d(),W(()=>[e.name,a.storySet,a.story],()=>{if(e.name==="select-story")if(a.storySet){let u=a.storySet.name[a.language];u?document.title=u:document.title="Arknights Tools | Story Reader"}else document.title="Arknights Tools | Story Reader";else if(e.name==="render-story"){if(a.story){let u=a.getStoryTitle(a.story.storyId);u?document.title=u:document.title="Arknights Tools | Story Reader"}}else document.title="Arknights Tools | Story Reader"},{immediate:!0})}),{loading:o,ready:l,errors:r,route:e}}});const St=N({name:"VApp",props:{...Le({fullHeight:!0}),...Z()},setup(e,a){let{slots:n}=a;const t=G(e),{layoutClasses:i,layoutStyles:o,getLayoutItem:l,items:r,layoutRef:d}=ke(e),{rtlClasses:u}=Ye();return E(()=>{var c;return s("div",{ref:d,class:["v-application",t.themeClasses.value,i.value,u.value],style:o.value},[s("div",{class:"v-application__wrap"},[(c=n.default)==null?void 0:c.call(n)])])}),{getLayoutItem:l,items:r,theme:t}}});const Vt=N({name:"VMain",props:X({tag:"main"}),setup(e,a){let{slots:n}=a;const{mainStyles:t}=De(),{ssrBootStyles:i}=fe();return E(()=>{var o;return s(e.tag,{class:"v-main",style:[t.value,i.value]},{default:()=>[s("div",{class:"v-main__wrap"},[(o=n.default)==null?void 0:o.call(n)])]})}),{}}});function Tt(e,a,n,t,i,o){const l=j("StoryReaderAppBar"),r=j("router-view");return V(),C(St,null,{default:T(()=>[e.loading?(V(),C(Ze,{key:0,indeterminate:""})):H("",!0),s(l),s(Vt,null,{default:T(()=>[e.route.name!=="render-story"?(V(),C(et,{key:0},{default:T(()=>[e.ready?(V(),C(r,{key:0})):H("",!0)]),_:1})):e.route.name==="render-story"?(V(),z(P,{key:1},[e.ready?(V(),C(r,{key:0})):H("",!0)],64)):H("",!0)]),_:1})]),_:1})}const At=q(wt,[["render",Tt]]);export{At as default};
