import{u as ie}from"./VBtn.24b0e5cd.js";import{q as ee,B as ue,A as ae,r as z,aj as pe,ak as ce,l as T,g as me,y as j,z as te,ai as U,n as G,a8 as fe,al as ge,am as V,an as X,ao as Y,ap as q,aq as W,ar as se,ah as Z}from"./index.8324d9c1.js";const M=Symbol.for("vuetify:layout"),re=Symbol.for("vuetify:layout-item"),J=1e3,xe=ee({overlaps:{type:Array,default:()=>[]},fullHeight:Boolean},"layout"),Ee=ee({name:{type:String},order:{type:[Number,String],default:0},absolute:Boolean},"layout-item");function Te(){const u=j(M);if(!u)throw new Error("[Vuetify] Could not find injected layout");return{getLayoutItem:u.getLayoutItem,mainRect:u.mainRect,mainStyles:u.mainStyles}}function be(u){var i;const a=j(M);if(!a)throw new Error("[Vuetify] Could not find injected layout");const n=(i=u.id)!=null?i:`layout-item-${ue()}`,e=ae("useLayoutItem");te(re,{id:n});const m=z(!1);pe(()=>m.value=!0),ce(()=>m.value=!1);const{layoutItemStyles:s,layoutItemScrimStyles:p}=a.register(e,{...u,active:T(()=>m.value?!1:u.active.value),id:n});return me(()=>a.unregister(n)),{layoutItemStyles:s,layoutRect:a.layoutRect,layoutItemScrimStyles:p}}const he=(u,a,n,e)=>{let m={top:0,left:0,right:0,bottom:0};const s=[{id:"",layer:{...m}}];for(const p of u){const i=a.get(p),o=n.get(p),f=e.get(p);if(!i||!o||!f)continue;const r={...m,[i.value]:parseInt(m[i.value],10)+(f.value?parseInt(o.value,10):0)};s.push({id:p,layer:r}),m=r}return s};function Ae(u){const a=j(M,null),n=T(()=>a?a.rootZIndex.value-100:J),e=z([]),m=U(new Map),s=U(new Map),p=U(new Map),i=U(new Map),o=U(new Map),{resizeRef:f,contentRect:r}=ie(),d=T(()=>{var g;const h=new Map,E=(g=u.overlaps)!=null?g:[];for(const b of E.filter(v=>v.includes(":"))){const[v,x]=b.split(":");if(!e.value.includes(v)||!e.value.includes(x))continue;const L=m.get(v),D=m.get(x),k=s.get(v),$=s.get(x);!L||!D||!k||!$||(h.set(x,{position:L.value,amount:parseInt(k.value,10)}),h.set(v,{position:D.value,amount:-parseInt($.value,10)}))}return h}),y=T(()=>{const h=[...new Set([...p.values()].map(g=>g.value))].sort((g,b)=>g-b),E=[];for(const g of h){const b=e.value.filter(v=>{var x;return((x=p.get(v))==null?void 0:x.value)===g});E.push(...b)}return he(E,m,s,i)}),C=T(()=>!Array.from(o.values()).some(h=>h.value)),l=T(()=>y.value[y.value.length-1].layer),c=T(()=>({"--v-layout-left":G(l.value.left),"--v-layout-right":G(l.value.right),"--v-layout-top":G(l.value.top),"--v-layout-bottom":G(l.value.bottom),...C.value?void 0:{transition:"none"}})),O=T(()=>y.value.slice(1).map((h,E)=>{let{id:g}=h;const{layer:b}=y.value[E],v=s.get(g),x=m.get(g);return{id:g,...b,size:Number(v.value),position:x.value}})),N=h=>O.value.find(E=>E.id===h),t=ae("createLayout"),I=z(!1);fe(()=>{I.value=!0}),te(M,{register:(h,E)=>{let{id:g,order:b,position:v,layoutSize:x,elementSize:L,active:D,disableTransitions:k,absolute:$}=E;p.set(g,b),m.set(g,v),s.set(g,x),i.set(g,D),k&&o.set(g,k);const K=ge(re,t==null?void 0:t.vnode).indexOf(h);K>-1?e.value.splice(K,0,g):e.value.push(g);const F=T(()=>O.value.findIndex(w=>w.id===g)),P=T(()=>n.value+y.value.length*2-F.value*2),ne=T(()=>{const w=v.value==="left"||v.value==="right",B=v.value==="right",le=v.value==="bottom",_={[v.value]:0,zIndex:P.value,transform:`translate${w?"X":"Y"}(${(D.value?0:-110)*(B||le?-1:1)}%)`,position:$.value||n.value!==J?"absolute":"fixed",...C.value?void 0:{transition:"none"}};if(!I.value)return _;const S=O.value[F.value];if(!S)throw new Error(`[Vuetify] Could not find layout item "${g}"`);const H=d.value.get(g);return H&&(S[H.position]+=H.amount),{..._,height:w?`calc(100% - ${S.top}px - ${S.bottom}px)`:L.value?`${L.value}px`:void 0,left:B?void 0:`${S.left}px`,right:B?`${S.right}px`:void 0,top:v.value!=="bottom"?`${S.top}px`:void 0,bottom:v.value!=="top"?`${S.bottom}px`:void 0,width:w?L.value?`${L.value}px`:void 0:`calc(100% - ${S.left}px - ${S.right}px)`}}),oe=T(()=>({zIndex:P.value-1}));return{layoutItemStyles:ne,layoutItemScrimStyles:oe,zIndex:P}},unregister:h=>{p.delete(h),m.delete(h),s.delete(h),i.delete(h),o.delete(h),e.value=e.value.filter(E=>E!==h)},mainRect:l,mainStyles:c,getLayoutItem:N,items:O,layoutRect:r,rootZIndex:n});const A=T(()=>["v-layout",{"v-layout--full-height":u.fullHeight}]),R=T(()=>({zIndex:n.value,position:a?"relative":void 0,overflow:a?"hidden":void 0}));return{layoutClasses:A,layoutStyles:R,getLayoutItem:N,items:O,layoutRect:r,layoutRef:f}}const de=u=>{var m,s,p;let a={lines:[],tagCount:{},otherLines:[]},n=u.split(`
`),e=i=>{i in a.tagCount||(a.tagCount[i]=0),a.tagCount[i]+=1};for(const i of n)if(i.match(V)){let o=V.exec(i);if(o!=null&&o.groups){let{tag:f,params:r,other:d}=o.groups;f=f.toUpperCase();let y={},C;for(;(C=X.exec(r))!==null;)if(C.groups){const{name:l,value:c}=C.groups;y[l]=c.replace(/"/g,"")}d&&(y.other=d),a.lines.push({tag:f,params:y}),e(f)}}else if(i.match(Y)){let o=Y.exec(i);if(o!=null&&o.groups){let{name:f,params:r,text:d}=o.groups,y={},C;if(r)for(;(C=X.exec((m=o==null?void 0:o.groups)==null?void 0:m.params))!==null;){let l=(s=C.groups)==null?void 0:s.name,c=((p=C.groups)==null?void 0:p.value)||"";l&&(y[l]=c.replace(/"/g,""))}a.lines.push({tag:"DIALOG",params:{...y,name:f,text:d}}),e("DIALOG")}}else if(i.match(q)){let o=q.exec(i);if(o!=null&&o.groups){let{tag:f,value:r}=o.groups;f=f.toUpperCase(),a.lines.push({tag:f,params:{[f]:r}}),e(f)}}else if(i.match(W)){let o=W.exec(i);if(o!=null&&o.groups){let{tag:f}=o.groups;f=f.toUpperCase(),a.lines.push({tag:f,params:{}}),e(f)}}else if(i.length>0&&i.indexOf("//")!==0&&i!=="\r"){let o="DESCRIPTION";a.lines.push({tag:o,params:{text:i}}),e(o)}else a.otherLines.push(i);return a},Q=/\[OPTION (?<value>.*)\]/g,Se=u=>{var n;let a={lines:[],tagCount:{},otherLines:[]};try{const e=u.find(m=>m[0]==="[LAYOUT]");if(e){const m=e.indexOf("[NAME]"),s=e.indexOf("[TEXT]");if(m&&s){for(let p=0;p<u.length;p++){const i=u[p];let o=i[0]||"";o=o.replace(/[\[\]]/g,"");const f=i[m],r=i[s];if(se.includes(o))a.lines.push({tag:o,params:{name:f,text:r}}),o in a.tagCount?a.tagCount[o]=a.tagCount[o]+1:a.tagCount[o]=1;else if(o==="DECISION"){let d=[],y=[];for(let C=p+1;C<u.length;C++){const l=u[C];if(l[0]==="[END_DECISION]"){a.lines.push({tag:"DECISION",params:{options:d.join(";"),values:y.join(";")}}),"DECISION"in a.tagCount?a.tagCount.DECISION=a.tagCount.DECISION+1:a.tagCount.DECISION=1,p=C;break}if(l[0].match(Q)){const c=Q.exec(l[0]);if(c){const O=(n=c.groups)==null?void 0:n.value;y.push(O),d.push(l[s])}}}}}return{result:a}}else return{error:"[NAME] or [TEXT] not found"}}else return{error:"[LAYOUT] not found"}}catch(e){return{error:e.message}}},Oe=({original:u,target:a})=>{let n=[],e={},m={};for(const s of a)s.tag in e||(e[s.tag]=[],m[s.tag]=0),e[s.tag].push(s);for(const s of u)if(s.tag in e)if(m[s.tag]<e[s.tag].length&&Object.keys(s.params).length>0){const p=e[s.tag][m[s.tag]],i=s;s.params.name&&p.params.name&&(i.params.name=p.params.name),s.params.text&&p.params.text&&(i.params.text=p.params.text),s.params.options&&p.params.options&&(i.params.options=p.params.options),n.push(i),m[s.tag]+=1}else n.push(s);else n.push(s);return n},Le=u=>{let a="1",n="1",e="";return u.split("#").length>1?([e,a]=u.split("#"),[a,n]=a.split("$")):u.split("$").length>1?[e,n]=u.split("$"):e=u.split("#")[0],{name:e,num:a,group:n||"1"}},Ne=async u=>{var i,o;let a=[],n=[],e,m,s="",p={};for(let f=0;f<u.length;f++){let r=u[f];switch(r.tag){case"DESCRIPTION":{e?e.tag==="DESCRIPTION"?e.params.text.push(r.params.text):(n.push(e),e={tag:"DESCRIPTION",params:{text:[r.params.text]}}):e={tag:"DESCRIPTION",params:{text:[r.params.text]}};break}case"SUBTITLE":{r.params.text&&(e?e.tag==="SUBTITLE"?e.params.text.push(r.params.text):(n.push(e),e={tag:"SUBTITLE",params:{text:[r.params.text]}}):e={tag:"SUBTITLE",params:{text:[r.params.text]}});break}case"DIALOG":{if(!r.params.text)break;let d={...r.params,text:[r.params.text],image:s};e?e.tag==="DIALOG"&&((o=(i=e.params)==null?void 0:i.name)==null?void 0:o.localeCompare(r.params.name,void 0,{sensitivity:"base"}))===0?e.params.text.push(r.params.text):(n.push(e),e={tag:"DIALOG",params:d}):e={tag:"DIALOG",params:d};break}case"MULTILINE":{let d={tag:"DIALOG",params:{...r.params,text:[r.params.other],image:s}};e&&n.push(e),e=d;break}case"DECISION":{e&&n.push(e);let d=r.params.options.split(";"),y=r.params.values.split(";"),C=!1;if(m){for(let l of y)if(m.options.includes(l)){C=!0;break}}C&&(a.push(n),n=[],e=null),(!m||C)&&(m={options:y}),e={...r,params:{options:d.map((l,c)=>({text:l,value:y[c]}))}};break}case"PREDICATE":{e&&n.push(e);let d=r.params.references.split(";");e={...r,params:{references:d}};break}case"IMAGE":{e&&n.push(e),e=r;break}case"BACKGROUND":{e&&n.push(e),e=r;break}case"CHARACTER":{if(r.params.focus)switch(parseInt(r.params.focus)){case 1:{s=r.params.name;break}case 2:{s=r.params.name2;break}default:{s="";break}}else s=r.params.name;break}case"CHARSLOT":r.params.name&&r.params.slot&&(p[r.params.slot]=r.params.name),r.params.focus&&p[r.params.focus]&&(s=p[r.params.focus])}}return e&&n[n.length-1]!==e&&n.push(e),a[a.length-1]!==n&&a.push(n),a},Ie={tags:{DIALOG:{enable:!0},MULTILINE:{enable:!0},DESCRIPTION:{enable:!0},SUBTITLE:{enable:!0},STICKER:{enable:!0},DECISION:{enable:!0},CHARACTER:{enable:!1},BACKGROUND:{enable:!0,type:"name"},IMAGE:{enable:!0,type:"name"}},extra:{layoutForStoryReader:!1,characterImageLookUpSheet:!1,characterNameSheet:!1,characterNameSheetWithImage:!1},sheet:{sheetName:"file"}},Re=(u,a=Ie)=>{var C;const n=["DIALOG","MULTILINE","CHARACTER"],e=["IMAGE","BACKGROUND"];let m=[];for(const[l,c]of Object.entries(a.tags))c.enable&&(m.push(l),l==="DECISION"&&m.push("PREDICATE"));let s="",p="",i={},o={},f=[],r=[],d={};const y=(l,c)=>{l in d||(d[l]=[]),c&&!d[l].includes(c)&&d[l].push(c)};for(const l of u){const c=[],O=de(l.data);a.extra.layoutForStoryReader&&(c.push(["[FILE]",l.fileName]),a.tags.CHARACTER.enable?c.push(["[LAYOUT]","","","","","[NAME]","[TEXT]"]):c.push(["[LAYOUT]","","","","[NAME]","[TEXT]"]));for(const t of O.lines)if(!(se.includes(t.tag)&&!t.params.text&&!t.params.other)&&!(t.tag==="IMAGE"&&!t.params.image)&&!(t.tag==="CHARACTER"&&!t.params.name)&&!(t.tag==="CHARSLOT"&&!t.params.name)&&m.includes(t.tag)){let I;switch(t.tag){case"DIALOG":{I=[t.params.name,t.params.text||t.params.other],t.params.head&&(p=t.params.head),a.extra.characterNameSheet&&y(t.params.name,p);break}case"MULTILINE":{I=[t.params.name,t.params.other],a.extra.characterNameSheet&&y(t.params.name,p);break}case"DESCRIPTION":{I=["",t.params.text];break}case"SUBTITLE":{I=["",t.params.text];break}case"STICKER":{I=["",t.params.text];break}case"DECISION":{let A=t.params.options.split(";"),R=t.params.values.split(";");((C=c[c.length-1])==null?void 0:C.length)>1&&s!=="PREDICATE"&&c.push([""]);let h=["[DECISION]"],E=["[END_DECISION]"];a.tags.CHARACTER.enable&&(h.push(""),E.push("")),a.extra.layoutForStoryReader&&(h.push("[DECISION]"),E.push("[END_DECISION]")),c.push(h);for(let g=0;g<A.length;g++){let b=A[g],v=R[g],x=[`[OPTION ${v}]`,b];a.tags.CHARACTER.enable&&(x=["",...x]),a.extra.layoutForStoryReader&&(x=[`[OPTION ${v}]`,...x]),o[v]=c.length+1,c.push(x)}c.push(E);break}case"PREDICATE":{let A=t.params.references.split(";"),R=[];for(const h of A)R.push(o[h]);I=["[PREDICATE]",A.join(","),R.join(",")];break}case"IMAGE":{if(t.params.image)switch(I=["[IMAGE]"],a.tags.IMAGE.type){case"name":{I.push(t.params.image);break}case"link":{I.push(`${Z}/images/avg/imgs/${t==null?void 0:t.params.image}.webp`);break}}break}case"BACKGROUND":{let A=t.params.image||"bg_black";switch(I=["[BACKGROUND]"],a.tags.BACKGROUND.type){case"name":{I.push(A);break}case"link":{I.push(`${Z}/images/avg/imgs/${A}.webp`);break}}break}case"CHARACTER":{t.params.name?t.params.name2&&t.params.focus==="2"?p=t.params.name2.toLowerCase():p=t.params.name.toLowerCase():p="";break}case"CHARSLOT":t.params.name&&t.params.slot&&(i[t.params.slot]=t.params.name),t.params.focus&&i[t.params.focus]&&(p=i[t.params.focus])}["CHARACTER","CHARSLOT"].includes(t.tag)&&a.extra.characterImageLookUpSheet&&!r.includes(p)&&r.push(p),c.length>0&&t.tag!==s&&t.tag!=="DECISION"&&s!=="PREDICATE"&&([...n,...e].includes(t.tag)?n.includes(t.tag)&&!n.includes(s)?c.push([""]):e.includes(t.tag)&&!e.includes(s)&&c.push([""]):c.push([""])),I&&(a.tags.CHARACTER.enable&&(["DIALOG","MULTILINE"].includes(t.tag)?I=[p,...I]:I=["",...I]),a.extra.layoutForStoryReader&&(I=[`[${t.tag}]`,...I]),c.push(I)),s=t.tag}let N=l.fileName;switch(a.sheet.sheetName){case"code":{N=l.code?l.code:l.fileName;break}case"code-name":{N=l.code&&l.name?`${l.code}: ${l.name}`:l.fileName;break}}f.push({name:N,aoa:c})}return a.extra.characterImageLookUpSheet&&(f=[{name:"Characters Images Lookup",aoa:r.sort((l,c)=>l.localeCompare(c)).map(l=>[l])},...f]),a.extra.characterNameSheet&&(f=[{name:"Characters",aoa:Object.keys(d).sort((l,c)=>l.localeCompare(c)).map(l=>{let c=[l];return a.extra.characterNameSheetWithImage&&(c=[...c,...d[l]]),c})},...f]),f},De=(u,a="zh_CN")=>{let n="";return u!=null&&u.code?n=`${u.code}: ${u.name[a]||u.name.zh_CN}`:n=`${u.name[a]||u.name.zh_CN}`,n};export{xe as a,Te as b,Ae as c,Ne as d,Se as e,De as f,Le as g,Ie as h,Re as i,Ee as m,Oe as r,de as s,be as u};
