import{d as T,g as m,_ as R,c as v,w as d,o as c,b as i,s as $,u as E,e as B,v as N,F as C,aF as q,y as p,f as X,m as ee,aO as te,t as I,B as oe,h as A,r as k,G as se,aP as re,O as b}from"./index.abfb314c.js";import{u as D,H as L,a as ae}from"./StoryReaderStore.62d1f282.js";import{R as ne,C as le,s as j,a as z,b as ie,r as ue}from"./CharImageDialog.cdae3a78.js";import{u as ce}from"./StoryTableStore.20eb9f7c.js";import{V as U}from"./VDialog.2bde1a24.js";import{V as H,a as Q,b as J}from"./VList.df4439d1.js";import{V as Y,a as de}from"./VCard.a6c9d27f.js";import{m as ye,i as me,a as Se,b as fe,u as ve,p as ge,c as he,d as pe,f as _e}from"./router.2bd6cf50.js";import{b as ke,u as $e,c as Ce,V as _}from"./VBtn.d9438d7e.js";import{m as Ve,u as be}from"./layout.540aacd2.js";import{m as Be,u as Ne}from"./tag.cb29de3f.js";import{u as Te}from"./useRender.f718f098.js";import{V as Re}from"./VDivider.3f5ed1de.js";import{V as De}from"./VContainer.9f85eb69.js";import"./VRow.1c7812c4.js";/* empty css              */import"./forwardRefs.62c1fbe2.js";import"./index.c0fe89d5.js";import"./resizeObserver.456e8566.js";const Ie=T({name:"StorySelectorDialog",emits:["selectStory"],setup(){const e=D();return{storySet:m(()=>e.storySet),getStoryTitle:o=>e.getStoryTitle(o)}}});function we(e,t,r,o,u,S){return c(),v(U,null,{default:d(()=>[i(Y,null,{default:d(()=>[i(H,null,{default:d(()=>{var s;return[(c(!0),$(C,null,E((s=e.storySet)==null?void 0:s.story,(a,f,n)=>(c(),v(Q,{key:n,onClick:l=>e.$emit("selectStory",f)},{default:d(()=>[i(J,null,{default:d(()=>[B(N(e.getStoryTitle(f.toString())),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]}),_:1})]),_:1})]),_:1})}const Pe=R(Ie,[["render",we]]),Fe=T({name:"StoryRenderBottomNav",setup(){const e=q(),t=p(!1),r=D(),o=m(()=>r.storySet),u=m(()=>r.story),S=m(()=>{let n="";return o.value&&u.value&&(u.value.code?n=`${u.value.code}: ${u.value.name[r.language]}`:n=`${u.value.name[r.language]}`),n});return{dialog:t,storyTitle:S,selectPreviousStory:()=>{var n;if(o.value){const l=Object.values((n=o.value)==null?void 0:n.story).find(y=>u.value?y.sort===u.value.sort-1:!1);l&&e.push({name:"render-story",query:{storyFile:l.file,storySetId:o.value.id}})}},selectNextStory:()=>{var n;if(o.value){const l=Object.values((n=o.value)==null?void 0:n.story).find(y=>u.value?y.sort===u.value.sort+1:!1);l&&e.push({name:"render-story",query:{storyFile:l.file,storySetId:o.value.id}})}},selectStory:n=>{if(t.value=!1,o.value){const l=o.value.story[n];e.push({name:"render-story",query:{storyFile:l.file,storySetId:o.value.id}})}}}},components:{StorySelectorDialog:Pe}});const M=X({name:"VBottomNavigation",props:{bgColor:String,color:String,grow:Boolean,mode:{type:String,validator:e=>!e||["horizontal","shift"].includes(e)},height:{type:[Number,String],default:56},...ye(),...me(),...Se(),...fe(),...Ve({name:"bottom-navigation"}),...Be({tag:"header"}),...ke({modelValue:!0,selectedClass:"v-btn--selected"}),...ee()},emits:{"update:modelValue":e=>!0},setup(e,t){let{slots:r}=t;const{themeClasses:o}=te(),{borderClasses:u}=ve(e),{backgroundColorClasses:S,backgroundColorStyles:s}=Ne(I(e,"bgColor")),{densityClasses:a}=ge(e),{elevationClasses:f}=he(e),{roundedClasses:n}=pe(e),l=m(()=>Number(e.height)-(e.density==="comfortable"?8:0)-(e.density==="compact"?16:0)),y=_e(e,"modelValue",e.modelValue),{layoutItemStyles:g}=be({id:e.name,order:m(()=>parseInt(e.order,10)),position:m(()=>"bottom"),layoutSize:m(()=>y.value?l.value:0),elementSize:l,active:y,absolute:I(e,"absolute")});return $e(e,Ce),oe({VBtn:{color:I(e,"color"),density:I(e,"density"),stacked:m(()=>e.mode!=="horizontal"),variant:"text"}},{scoped:!0}),Te(()=>i(e.tag,{class:["v-bottom-navigation",{"v-bottom-navigation--active":y.value,"v-bottom-navigation--grow":e.grow,"v-bottom-navigation--shift":e.mode==="shift"},o.value,S.value,u.value,a.value,f.value,n.value],style:[s.value,g.value,{height:A(l.value),transform:`translateY(${A(y.value?0:100,"%")})`}]},{default:()=>[r.default&&i("div",{class:"v-bottom-navigation__content"},[r.default()])]})),{}}});function Ge(e,t,r,o,u,S){const s=k("StorySelectorDialog");return c(),$(C,null,[i(s,{modelValue:e.dialog,"onUpdate:modelValue":t[0]||(t[0]=a=>e.dialog=a),onSelectStory:e.selectStory},null,8,["modelValue","onSelectStory"]),i(M,{density:"compact"},{default:d(()=>[i(_,{icon:"mdi-chevron-left",onClick:e.selectPreviousStory},null,8,["onClick"]),i(_,{variant:"text",class:"story-title-btn",onClick:t[1]||(t[1]=a=>e.dialog=!0)},{default:d(()=>[B(N(e.storyTitle),1)]),_:1}),i(_,{icon:"mdi-chevron-right",onClick:e.selectNextStory},null,8,["onClick"])]),_:1})],64)}const Le=R(Fe,[["render",Ge],["__scopeId","data-v-f1ff141a"]]),ze=T({name:"StorySelectorDialogGoogleSheets",emits:["selectStory"],setup(){const e=D(),t=m(()=>e.spreadsheet),r=m(()=>{var o;return((o=t.value)==null?void 0:o.sheets)||[]});return{spreadsheet:t,sheets:r}}});function Ee(e,t,r,o,u,S){return c(),v(U,null,{default:d(()=>[i(Y,null,{default:d(()=>{var s;return[i(_,{variant:"text",href:(s=e.spreadsheet)==null?void 0:s.url},{default:d(()=>{var a;return[B(N(((a=e.spreadsheet)==null?void 0:a.title)||""),1)]}),_:1},8,["href"]),i(Re),i(H,null,{default:d(()=>[(c(!0),$(C,null,E(e.sheets,(a,f)=>(c(),v(Q,{key:f,onClick:n=>e.$emit("selectStory",f)},{default:d(()=>[i(J,null,{default:d(()=>[B(N(a),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})]}),_:1})]),_:1})}const Oe=R(ze,[["render",Ee]]),Ae=T({name:"StoryRenderBottomNavGoogleSheets",setup(){const e=p(!1),t=D(),r=m(()=>t.spreadsheet?t.spreadsheet.sheets[t.spreadsheet.currentSheet]:"");return{dialog:e,storyTitle:r,selectPreviousStory:()=>{var s;if(t.spreadsheet){const a=(s=t.spreadsheet)==null?void 0:s.sheets[t.spreadsheet.currentSheet-1];t.spreadsheet.currentSheet>0&&a&&t.setSpreadsheetCurrentSheet(t.spreadsheet.currentSheet-1)}},selectNextStory:()=>{var s;t.spreadsheet&&((s=t.spreadsheet)==null?void 0:s.sheets[t.spreadsheet.currentSheet+1])&&t.setSpreadsheetCurrentSheet(t.spreadsheet.currentSheet+1)},selectStory:s=>{e.value=!1,t.setSpreadsheetCurrentSheet(s)}}},components:{StorySelectorDialogGoogleSheets:Oe}});function je(e,t,r,o,u,S){const s=k("StorySelectorDialogGoogleSheets");return c(),$(C,null,[i(s,{modelValue:e.dialog,"onUpdate:modelValue":t[0]||(t[0]=a=>e.dialog=a),onSelectStory:e.selectStory},null,8,["modelValue","onSelectStory"]),i(M,{density:"compact"},{default:d(()=>[i(_,{icon:"mdi-chevron-left",onClick:e.selectPreviousStory},null,8,["onClick"]),i(_,{variant:"text",class:"story-title-btn",onClick:t[1]||(t[1]=a=>e.dialog=!0)},{default:d(()=>[B(N(e.storyTitle),1)]),_:1}),i(_,{icon:"mdi-chevron-right",onClick:e.selectNextStory},null,8,["onClick"])]),_:1})],64)}const qe=R(Ae,[["render",je],["__scopeId","data-v-88119425"]]),Ue=T({name:"StoryRender",props:["storyFile","storySetId","type"],components:{RenderBlock:ne,CharImageDialog:le,StoryRenderBottomNav:Le,StoryRenderBottomNavGoogleSheets:qe},setup(e){const t=q(),r=D(),{storyTable:o,storyList:u}=ce(),S=p(!1),s=p(!1),a=p([]),f=p(""),n=m(()=>r.language),l=m(()=>r.storySet),y=p([]);return se(()=>{var g;return[e.storyFile,e.storySetId,e.type,n.value,(g=r.spreadsheet)==null?void 0:g.currentSheet]},async()=>{var g;try{if(S.value=!0,e.type==="original"){e.storySetId&&r.setStorySet(o==null?void 0:o.story[e.storySetId]),e.storyFile||(l.value?t.push({name:re[l.value.type].routeName||"select-story-type"}):t.push({name:"select-story-type"})),l.value&&r.setStory(Object.values(l.value.story).find(O=>O.file===e.storyFile));const w=(await L.get(`/story/${n.value}/${e.storyFile}.txt`)).data,P=j(w);y.value=await z(P.lines),s.value=!0,window.scrollTo(0,0)}else if(e.type==="spreadsheet")if(r.spreadsheet){const{id:h,sheets:w,currentSheet:P}=r.spreadsheet,F=(g=(await L.get(`https://sheets.googleapis.com/v4/spreadsheets/${h}/values/'${w[P]}'`,{params:{key:"AIzaSyDu129ufi2q02ZHJhoLYsO_0ew6nh9kQAQ"}})).data)==null?void 0:g.values,V=ie(F);if(!V.error)if(F[0][0]==="[FILE]"){const Z=F[0][1],x=u.find(G=>G.includes(Z)),K=(await L.get(`/story/zh_CN/${x}`)).data,W=j(K);if(V.result){const G=ue({original:W.lines,target:V.result.lines});y.value=await z(G),s.value=!0,window.scrollTo(0,0)}}else V.result&&(y.value=await z(V.result.lines),s.value=!0,window.scrollTo(0,0))}else t.push({name:"google-sheets"});else t.push({name:"select-story-type"})}catch(h){h instanceof ae.exports.AxiosError&&n.value!=="zh_CN"&&(h==null?void 0:h.code)==="ERR_BAD_REQUEST"?r.setLanguage("zh_CN"):a.value.push(h)}finally{S.value=!1}},{immediate:!0}),{loading:S,ready:s,charImage:f,errors:a,storySet:l,renderBlocks:y}}});function He(e,t,r,o,u,S){const s=k("RenderBlock"),a=k("StoryRenderBottomNav"),f=k("StoryRenderBottomNavGoogleSheets"),n=k("CharImageDialog");return c(),$(C,null,[e.loading?(c(),v(de,{key:0,indeterminate:""})):b("",!0),e.ready?(c(),v(De,{key:1},{default:d(()=>[(c(!0),$(C,null,E(e.renderBlocks,(l,y)=>(c(),v(s,{key:y,"render-block":l,onSelectCharImage:t[0]||(t[0]=g=>{e.charImage=g})},null,8,["render-block"]))),128))]),_:1})):b("",!0),e.type==="original"?(c(),v(a,{key:2})):b("",!0),e.type==="spreadsheet"?(c(),v(f,{key:3})):b("",!0),e.ready?(c(),v(n,{key:4,"char-image":e.charImage,onCloseDialog:t[1]||(t[1]=l=>e.charImage="")},null,8,["char-image"])):b("",!0)],64)}const dt=R(Ue,[["render",He]]);export{dt as default};
